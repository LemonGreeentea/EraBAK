;-------------------------------------------------
;「부대편성」의 명칭
;-------------------------------------------------
@SHOP_SLG_NAME31
RESULTS:0 '= "부대편성"

;-------------------------------------------------
;「부대편성」의 선택 가부
;-------------------------------------------------
@SHOP_SLG_CHECK31
SIF FLAG:클리어플래그
	RETURN 0
SIF FLAG:관전모드
	RETURN 0
SIF CFLAG:MASTER:소속 == 0
	RETURN 0
SIF CONFIG:302 != 0
	RETURN 0
SIF DAY < SLG_PP:1
	RETURN 0
RETURN 1

;-------------------------------------------------
;「부대편성」의 왼쪽 컬럼 메뉴의 입력 처리
;-------------------------------------------------
@SHOP_SLG_EVENTBUY31
CALL FORM_ARMY(CFLAG:MASTER:소속)

;-------------------------------------------------
;「부대편성」본체
;-------------------------------------------------
@FORM_ARMY(ARG:0)
LOCAL:5 = ARG:0
LOCAL:6 = GET_SUM_ARMY_DF(LOCAL:5)

CALL SINGLE_DRAWLINE
PRINTL ●부대편성(적지에 있는 부대, 현재지에 적이 있는 부대는 붉게 표시됩니다)
CALL SINGLE_DRAWLINE
PRINTFORML 총병수:  %NUM_FORMAT(GET_SUM_SOLDIER(LOCAL:5))%
PRINTFORML 방위병수:%NUM_FORMAT(GET_SUM_ARMY_DF(LOCAL:5))%
PRINTFORML 잔존병수:%NUM_FORMAT(COUNTRY_SOLDIER:(LOCAL:5))%
CALL SINGLE_DRAWLINE

LOCAL:3 = 0
FOR LOCAL:0, 0, MAX_UNIT
	IF UNIT_SOLDIER:(LOCAL:5):(LOCAL:0) > 0
		LOCAL:3 = 1
		SIF CHECK_COUNTRY_RELATION_F(ARG:0, CITY_OWNER:(UNIT_POSITION:(LOCAL:5):(LOCAL:0))) == 0 || IS_STAY_ENEMY_UNIT(UNIT_POSITION:(LOCAL:5):(LOCAL:0))
			SETCOLOR 칼라_경고
			PRINTBUTTON @"{LOCAL:0 + 1, 2}[  부대{LOCAL:0 + 1, 2}]", LOCAL:0 + 1
			PRINT   
		CALL SHOW_UNIT_INFO(LOCAL:5, LOCAL:0, 12)
		RESETCOLOR
	ENDIF
NEXT
IF !LOCAL:3
	PRINTFORML 현재 편성중의 부대는 없습니다
ENDIF

CALL SINGLE_DRAWLINE
PRINTBUTTON "20[신규부대]", 20
PRINTL 
PRINTBUTTON "30[추천 편성 제외 설정]", 30
PRINTL
PRINTBUTTON "40[일괄보충]", 40
PRINTL
PRINTBUTTON " 0[돌아온다]", 0
PRINTL 

$INPUT_LOOP
INPUT

IF RESULT == 20
	LOCAL:1 = 0
	FOR LOCAL:0, 0, MAX_UNIT
		IF UNIT_SOLDIER:(LOCAL:5):(LOCAL:0) <= 0
			LOCAL:1 = 1
			CALL CREATE_UNIT(LOCAL:5, LOCAL:0)
			BREAK
		ENDIF
	NEXT
	IF !LOCAL:1
		PRINTW 더 이상 부대를 편성할 수 없습니다
	ENDIF
	RESTART
ELSEIF RESULT == 30
	CALL EXCLUDE_BEST_COMMANDER
	RESTART
ELSEIF RESULT == 40
	CALL UNIT_SOLDIER_REPLENISH(ARG:0)
	RESTART
ELSEIF RESULT == 0
	RETURN
ELSEIF RESULT >= 1 && RESULT <= MAX_UNIT && UNIT_SOLDIER:(LOCAL:5):(RESULT - 1) > 0
	CALL UNIT_SETTING(LOCAL:5, RESULT - 1)
	RESTART
ENDIF
GOTO INPUT_LOOP

;-------------------------------------------------
;ARG:0 세력, 부대 ARG:1의 정보 표시  ARG:2=조정용 스페이스의 수
;-------------------------------------------------
@SHOW_UNIT_INFO(ARG:0, ARG:1, ARG:2 = 0)
PRINTFORM 병 수:%NUM_FORMAT(UNIT_SOLDIER:(ARG:0):(ARG:1)), 7, LEFT% 소재:
LOCAL:2 = UNIT_POSITION:(ARG:0):(ARG:1)
LOCALS:0 = %GET_RELAYNAME(LOCAL:2)%
IF LOCALS:0 == "무명"
	LOCALS:0 = ----
ENDIF
PRINTFORM %LOCALS:0, 14, LEFT%
PRINT   목표:
LOCAL:2 = UNIT_TARGET:(ARG:0):(ARG:1)
LOCALS:0 = %GET_RELAYNAME(LOCAL:2)%
IF LOCALS:0 == "무명"
	LOCALS:0 = 없음
ENDIF
CALL GET_UNIT_COMMANDER_ALL(ARG:0, ARG:1)
CALL SET_BATTLE_MIRROR_VAL(0, RESULT:0, RESULT:1, RESULT:2)
PRINTFORM %LOCALS:0, 14, LEFT%
PRINTFORM 공:
CALL PRINT_ALPHABET_RANK(랭크_부대, ATTACK_LEVEL(0, 0))
PRINTFORM   방:
CALL PRINT_ALPHABET_RANK(랭크_부대, DEFENSE_LEVEL(0, 0))
PRINTFORM   지:
CALL PRINT_ALPHABET_RANK(랭크_부대, INTELLIGENCE_LEVEL(0, 0))
PRINTFORM   피:{UNIT_TIRED_COUNT:(ARG:0):(ARG:1)}
PRINTL 
PRINTFORML %TOSTR_SPACE(ARG:2)%장:%GET_UNIT_COMMANDER_NAME(ARG:0, ARG:1)%

;-------------------------------------------------
;ARG:0 세력, 부대 ARG:1의 정보 표시
;-------------------------------------------------
@SHOW_UNIT_INFO_SIMPLE(ARG:0, ARG:1)
PRINTFORM 병 수:{UNIT_SOLDIER:(ARG:0):(ARG:1), 7, LEFT} 
CALL GET_UNIT_COMMANDER_ALL(ARG:0, ARG:1)
CALL SET_BATTLE_MIRROR_VAL(0, RESULT:0, RESULT:1, RESULT:2)
PRINTFORM 공:
CALL PRINT_ALPHABET_RANK(랭크_부대, ATTACK_LEVEL(0, 0))
PRINTFORM   방:
CALL PRINT_ALPHABET_RANK(랭크_부대, DEFENSE_LEVEL(0, 0))
PRINTFORM   지:
CALL PRINT_ALPHABET_RANK(랭크_부대, INTELLIGENCE_LEVEL(0, 0))
PRINTFORM   피:{UNIT_TIRED_COUNT:(ARG:0):(ARG:1)}
PRINTFORML   장:%GET_UNIT_COMMANDER_NAME(ARG:0, ARG:1)%


;-------------------------------------------------
;ARG:0 세력의 ARG:1번 부대에 대한 설정
;ARG:2는 침공 버튼으로부터 날아 온 플래그
;-------------------------------------------------
@UNIT_SETTING(ARG:0, ARG:1, ARG:2 = 0)
;부대가 있는 도시의 세력과의 관계를 취득
CALL CHECK_COUNTRY_RELATION(ARG:0, CITY_OWNER:(UNIT_POSITION:(ARG:0):(ARG:1)))
LOCAL:5 = RESULT:0
SIF IS_STAY_ENEMY_UNIT(UNIT_POSITION:(ARG:0):(ARG:1))
	LOCAL:5 = 0

CALL SINGLE_DRAWLINE
PRINTFORML ●부대{ARG:1 + 1}에의 지시
PRINT     
CALL SHOW_UNIT_INFO(ARG:0, ARG:1, 4)
CALL SINGLE_DRAWLINE

IF ARG:2 == 0 && LOCAL:5 >= 1
	PRINTBUTTON " 0[이동／목표 설정]", 0
	PRINTL 
ELSEIF ARG:2 == 0 && LOCAL:5 < 1
	SETCOLOR 칼라_선택불가
	PRINTPLAIN  0[이동／목표 설정]
	PRINTL
	RESETCOLOR
ELSE
	PRINTBUTTON " 0[이 부대에서 결정]", 0
	PRINTL 
ENDIF
IF LOCAL:5 >= 1
	PRINTBUTTON " 1[병 수의 변경]", 1
	PRINTL 
	PRINTBUTTON " 2[  장의 변경]", 2
	PRINTL 
	PRINTBUTTON " 3[      해산]", 3
	PRINTL 
	SETCOLOR 칼라_선택불가
	PRINTPLAIN  4[  강제 해산]
	RESETCOLOR
	PRINTL 
ELSE
	SETCOLOR 칼라_선택불가
	PRINTPLAIN  1[병 수의 변경]
	PRINTL 
	PRINTPLAIN  2[  장의 변경]
	PRINTL 
	PRINTPLAIN  3[      해산]
	PRINTL 
	RESETCOLOR
	PRINTBUTTON " 4[  강제 해산]", 4
	PRINTL 
ENDIF
CALL SINGLE_DRAWLINE
PRINTBUTTON " 9[      돌아온다]", 9
PRINTL 

$INPUT_LOOP1
INPUT

IF RESULT == 0 && ARG:2 == 0 && LOCAL:5 >= 1
	CALL SINGLE_DRAWLINE
	CALL SET_CITY_COLOR_COUNTRY
	CALL SET_CITY_COLOR_UNIT
	CALL DRAWMAP
	CALL RESET_CITY_COLOR
	CALL SINGLE_DRAWLINE

	PRINTFORML 부대{ARG:1 + 1}의 이동처를 결정해 주세요
	PRINTFORML 자세력의 도시, 동맹·연합 세력의 도시, 및 그것들에 인접한 적대 도시만이 선택 가능합니다
	PRINTFORML 현재의 위치:%GET_RELAYNAME(UNIT_POSITION:(ARG:0):(ARG:1))%
	PRINTBUTTON "[캔슬]", 0
	PRINTL 

	$INPUT_LOOP2
	INPUT

	IF RESULT == 0
		RESTART
	ELSEIF RESULT >= 1001 && RESULT <= 1001 + CITY_NUM
		LOCAL:2 = RESULT - 1000

		;세력간의 관계를 취득
		CALL CHECK_COUNTRY_RELATION(ARG:0, CITY_OWNER:(LOCAL:2))
		LOCAL:7 = RESULT:0

		;정전중의 세력에의 이동
		IF LOCAL:7 == 1
			PRINTFORMW 정전중의 세력의 도시에 부대를 이동시킬 수 없습니다
			RESTART

		;현재 위치와 같은 장소를 선택
		ELSEIF LOCAL:2 == UNIT_POSITION:(ARG:0):(ARG:1)
			UNIT_TARGET:(ARG:0):(ARG:1) = 0
			PRINTFORMW 목표의 설정을 해제합니다
			RESTART

		;자세력·우호 세력으로부터 자세력·우호 세력에의 이동
		ELSEIF LOCAL:5 >= 1 && LOCAL:7 >= 2
			LOCAL:3 = UNIT_POSITION:(ARG:0):(ARG:1)
			LOCAL:4 = UNIT_TARGET:(ARG:0):(ARG:1)
			UNIT_POSITION:(ARG:0):(ARG:1) = LOCAL:2
			UNIT_TARGET:(ARG:0):(ARG:1) = 0
			PRINTFORML 부대{ARG:1 + 1}를 %GET_RELAYNAME(LOCAL:2)%에 이동했습니다
			IF LOCAL:3 >= 1 && LOCAL:3 != LOCAL:4
				PRINTFORML 현재의 이동 목표는 해제됩니다
			ENDIF
			WAIT
			RESTART

		;적대한다（쳐들어갈 수 있다）도시를 선택
		ELSEIF IS_INVADABLE(LOCAL:2, ARG:0)
			CALL FORCE_SELECT_DEPARTURE_POINT(LOCAL:2, ARG:1)
			RESTART
		ENDIF
	ENDIF
	GOTO INPUT_LOOP2
;침공·이동 버튼으로부터 날아 왔다
ELSEIF RESULT == 0 && ARG:2 == 1
	RETURN 1
;병 수의 변경
ELSEIF RESULT == 1 && LOCAL:5 >= 1
	LOCAL:2 = UNIT_SOLDIER:(ARG:0):(ARG:1)
	LOCAL:3 = COUNTRY_SOLDIER:(ARG:0) + LOCAL:2
	CALL SINGLE_DRAWLINE
	PRINTFORML 부대의 병수를 입력해 주세요(잔존병수:%NUM_FORMAT(LOCAL:3)%)
	PRINTFORML 현재의 병수는 %NUM_FORMAT(LOCAL:2)%입니다
	PRINTFORML 0 이하의 수를 입력한다고 변경하지 않고 돌아옵니다

	CALL DRAW_SOLDIER_INPUT(LOCAL:3)

	$INPUT_LOOP3
	INPUT

	IF RESULT <= 0
		RESTART
	ELSEIF RESULT < 500
		CLEARLINE 1
		PRINTL 최악이어도 500의 병수가 필요합니다
		GOTO INPUT_LOOP3
	ELSEIF RESULT <= LOCAL:3
		COUNTRY_SOLDIER:(ARG:0) += LOCAL:2
		UNIT_SOLDIER:(ARG:0):(ARG:1) = RESULT
		COUNTRY_SOLDIER:(ARG:0) -= RESULT
		PRINTFORMW {ARG:1 + 1}번대의 병수를 %NUM_FORMAT(RESULT)%로 설정합니다
		RESTART
	ENDIF

	CLEARLINE 1
	PRINTL 병 수가 부족합니다
	GOTO INPUT_LOOP3

;장의 변경
ELSEIF RESULT == 2 && LOCAL:5 >= 1
	CALL SELECT_UNIT_COMMANDER(ARG:0, ARG:1)
	RESTART

;해산
ELSEIF RESULT == 3 && LOCAL:5 >= 1
	PRINTFORML 부대{ARG:1 + 1}를 해산합니다. 좋습니까?
	CALL ASK_YN
	IF RESULT == 0
		FOR LOCAL, 0, 3
			LOCAL:(10 + LOCAL) = GET_UNIT_COMMANDER(ARG:0, ARG:1, LOCAL)
		NEXT
		CALL CLEAR_UNIT(ARG:0, ARG:1)
		FOR LOCAL, 0, 3
			SIF LOCAL:(10 + LOCAL) >= 0 && ASSIGNED_THIS_TURN:(LOCAL:(10 + LOCAL)):0
				COOLTIME:(LOCAL:(10 + LOCAL)):0 = 0
		NEXT
		RETURN
	ENDIF
	RESTART

;강제 해산
ELSEIF RESULT == 4 && LOCAL:5 < 1
	PRINTFORML 부대{ARG:1 + 1}를 전선으로부터 이탈시켜, 해산시킵니다
	PRINTFORML 병의 반(정도)만큼이 없어져 무장에 3 턴의 쿨 타임이 다합니다. 좋습니까?
	CALL ASK_YN
	IF RESULT == 0
		COUNTRY_SOLDIER:(ARG:0) += UNIT_SOLDIER:(ARG:0):(ARG:1) * RAND(40, 60) / 100
		UNIT_SOLDIER:(ARG:0):(ARG:1) = 0
		FOR LOCAL, 0, GET_UNIT_COMMANDER_NUM(ARG:0, ARG:1)
			LOCAL:1 = GET_UNIT_COMMANDER(ARG:0, ARG:1, LOCAL)
			SIF LOCAL:1 >= 0
				CALL ADD_COOLTIME(LOCAL:1, 3, 1, 0)
		NEXT
		CALL CLEAR_UNIT(ARG:0, ARG:1)
		RETURN
	ENDIF
	RESTART
ELSEIF RESULT == 9
	RETURN
ENDIF
GOTO INPUT_LOOP1

;-------------------------------------------------
;도시 ARG:0의 방위병수를 설정
;-------------------------------------------------
@SHOP_CITY_SOLDIER(ARG:0)
LOCAL:2 = CITY_SOLDIER:(ARG:0)
LOCAL:3 = COUNTRY_SOLDIER:(CITY_OWNER:(ARG:0)) + LOCAL:2
CALL SINGLE_DRAWLINE
PRINTFORML %GET_CITYNAME(ARG:0)%의 방위병수를 입력해 주세요(잔존병수:%NUM_FORMAT(LOCAL:3)%)
PRINTFORML 현재의 방위병수는 %NUM_FORMAT(LOCAL:2)%입니다
PRINTFORML 0 이하의 수를 입력하면 현재의 병수를 유지합니다
CALL SINGLE_DRAWLINE

CALL DRAW_SOLDIER_INPUT(LOCAL:3)

$INPUT_LOOP1
INPUT

IF RESULT > 0 && RESULT < 500
	CLEARLINE 1
	PRINTL 최악이어도 500의 병수가 필요합니다
	GOTO INPUT_LOOP1
ELSEIF RESULT >= 500 && RESULT <= LOCAL:3
	COUNTRY_SOLDIER:(CITY_OWNER:(ARG:0)) += CITY_SOLDIER:(ARG:0)
	CITY_SOLDIER:(ARG:0) = RESULT
	COUNTRY_SOLDIER:(CITY_OWNER:(ARG:0)) -= CITY_SOLDIER:(ARG:0)
ELSEIF RESULT > LOCAL:3
	CLEARLINE 1
	PRINTL 병 수가 부족합니다
	GOTO INPUT_LOOP1
ENDIF

;-------------------------------------------------
;도시 ARG:0의 수장을 설정
;-------------------------------------------------
@SHOP_CITY_COMMANDER(ARG:0)
#DIM 원캐릭터, MAX_CITY_COMMANDER
#DIM 도시공격
#DIM 도시방어
#DIM 도시지략
#DIM 도시요술
#DIM FIRST_LINE
원캐릭터:0 = GET_CITY_COMMANDER(ARG:0, 0), GET_CITY_COMMANDER(ARG:0, 1)

;사관이 부대에 소속해 있는지 어떤지의 맵을 작성(고속화용)
CALL TMP_CREATE_IS_FREE_MAP

;다만, 현재 그 도시에서 수장을 하고 있는 캐릭터에 대해서는, 프리이라고 간주한다（가 아니면 해제했을 때에 선택 할 수 없게 되므로）
FOR LOCAL, 0, 2
	LOCAL:1 = GET_CITY_COMMANDER(ARG:0, LOCAL)
	IF LOCAL:1 != -1
		PRINTFORML %ANAME(LOCAL:1)%
		TMP_IS_FREE:(LOCAL:1):0 = 0
	ENDIF
NEXT


;수장설정의 페이지수의 계산
LOCAL:12 = 0
FOR LOCAL:0, 0, CHARANUM
	;마스터와 소속 세력이 같은 캐릭터만 ※서당 내왕은 제외
	IF (CFLAG:(LOCAL:0):소속 == CITY_OWNER:(ARG:0))
		LOCAL:12 ++
	ENDIF
NEXT
LOCAL:12 = (LOCAL:12 - 1) / 40 + 1
LOCAL:13 = 1
FIRST_LINE = LINECOUNT
$SHOW_LOOP2
CALL GET_CITY_COMMANDER_ALL(ARG:0)
LOCAL:4 = RESULT:0, RESULT:1
CALL SET_BATTLE_MIRROR_VAL(0, RESULT:0, RESULT:1, RESULT:2)
도시공격 = ATTACK_LEVEL(0, ARG:0)
도시방어 = DEFENSE_LEVEL(0, ARG:0)
도시지략 = INTELLIGENCE_LEVEL(0, ARG:0)
도시요술 = MAGIC_LEVEL(0, ARG:0)
LOCAL:1 = MAX(GET_DIGIT(도시공격), GET_DIGIT(도시방어), GET_DIGIT(도시지략), GET_DIGIT(도시요술), 6) + 1

CALL SINGLE_DRAWLINE
PRINTFORML %GET_CITYNAME(ARG:0)%의 수장을 설정해 주세요(최대 2명까지)
PRINTFORML 【현재의 방위 능력】
PRINTFORM 공격:
CALL PRINT_ALPHABET_RANK(랭크_부대, 도시공격)
PRINTFORML {도시공격, LOCAL:1}
PRINTFORM 방어:
CALL PRINT_ALPHABET_RANK(랭크_부대, 도시방어)
PRINTFORML {도시방어, LOCAL:1}
PRINTFORM 지략:
CALL PRINT_ALPHABET_RANK(랭크_부대, 도시지략)
PRINTFORML {도시지략, LOCAL:1}
PRINTFORM 요술:
CALL PRINT_ALPHABET_RANK(랭크_부대, 도시요술)
PRINTFORML {도시요술, LOCAL:1}
PRINTBUTTON "[능력일람 표시]", 11
PRINTL
CALL SINGLE_DRAWLINE
PRINTFORM %TOSTR_SPACE(14)%   무|  방|  지|  정|  술|  가|  요 %TOSTR_SPACE(17)%   무|  방|  지|  정|  술|  가|  요
PRINTL 
LOCAL:25 = 15
LOCAL:1 = 0
LOCAL:14 = 0
LOCAL:15 = (LOCAL:13 - 1) * 40
LOCAL:16 = LOCAL:13 * 40
FOR LOCAL:0, 0, CHARANUM
	;마스터와 소속 세력이 같은 캐릭터만  ※서당 내왕은 제외
	IF (CFLAG:(LOCAL:0):소속 == CITY_OWNER:(ARG:0))
		IF LOCAL:14 >= LOCAL:15 && LOCAL:14 < LOCAL:16
			IF LOCAL:1 % 2 != 0
				PRINT 　　
			ELSEIF LOCAL:1 >= 1
				PRINTL 
				LOCAL:25 ++
			ENDIF
			IF GROUPMATCH(LOCAL, LOCAL:4, LOCAL:5)
				SETCOLOR 칼라_선택중
			ELSEIF CFLAG:LOCAL:행동불능상태 == 행동불능_임월
				SETCOLOR 칼라_경고
			ELSEIF TALENT:LOCAL:임신
				SETCOLOR 칼라_주의
			ELSEIF CFLAG:LOCAL:행동불능상태 == 행동불능_육아
				SETCOLOR 칼라_황록
			ENDIF
			IF TMP_IS_FREE:(LOCAL:0):0 == 0
				PRINTFORM [{NO:(LOCAL:0) + 99, 4}]%SNAME(LOCAL:0), MAX_CHARANAME_LENGTH / 2, RIGHT%
				PRINTFORM    
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):무투)
				PRINTFORM {ABL:(LOCAL:0):무투, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):방위)
				PRINTFORM {ABL:(LOCAL:0):방위, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):지략)
				PRINTFORM {ABL:(LOCAL:0):지략, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):정치)
				PRINTFORM {ABL:(LOCAL:0):정치, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):요술)
				PRINTFORM {ABL:(LOCAL:0):요술, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):가창)
				PRINTFORM {ABL:(LOCAL:0):가창, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):요리)
				PRINTFORM {ABL:(LOCAL:0):요리, 3}
			ELSE
				LOCALS:0 = [{NO:(LOCAL:0) + 99, 4}]
				LOCALS:0 += @"%SNAME(LOCAL:0), MAX_CHARANAME_LENGTH / 2, RIGHT%"
				IF TMP_IS_FREE:LOCAL:0 == 1
					LOCALS:0 += @" 부"
				ELSEIF TMP_IS_FREE:LOCAL:0 == 2
					LOCALS:0 += @" 수"
				ELSEIF COOLTIME:(LOCAL:0):0
					LOCALS:0 += @" %TOFULL(TOSTR(COOLTIME:(LOCAL:0):0))%"
				ELSEIF TMP_IS_FREE:LOCAL:0 == -1
					LOCALS:0 += @" 외"
				ELSE
					LOCALS:0 += @"   "
				ENDIF

				LOCALS:0 += @"%ALPHABET_RANK(0, ABL:LOCAL:무투)%{ABL:(LOCAL:0):무투, 3}|%ALPHABET_RANK(0, ABL:LOCAL:지략)%{ABL:(LOCAL:0):방위, 3}|%ALPHABET_RANK(0, ABL:LOCAL:지략)%{ABL:(LOCAL:0):지략, 3}|"
				LOCALS:0 += @"%ALPHABET_RANK(0, ABL:LOCAL:정치)%{ABL:(LOCAL:0):정치, 3}|%ALPHABET_RANK(0, ABL:LOCAL:요술)%{ABL:(LOCAL:0):요술, 3}|%ALPHABET_RANK(0, ABL:LOCAL:가창)%{ABL:(LOCAL:0):가창, 3}|%ALPHABET_RANK(0, ABL:LOCAL:요리)%{ABL:(LOCAL:0):요리, 3}"
				SETCOLOR 칼라_선택불가
				PRINTPLAINFORM %LOCALS:0%
			ENDIF
			RESETCOLOR
			LOCAL:1 ++
		ENDIF
		LOCAL:14 ++
	ENDIF
NEXT
PRINTL 
CALL SINGLE_DRAWLINE

IF LOCAL:12 >= 2
	LOCAl:25 ++
	IF LOCAL:13 > 1
		PRINT [  8] 이전페이지            
	ELSE
		PRINT                             
	ENDIF
	LOCALS:0 = page{LOCAL:13}/{LOCAL:12}
	PRINTPLAINFORM %LOCALS:0, 28, LEFT%
	IF LOCAL:13 < LOCAL:12
		PRINT [  9] 다음페이지
	ENDIF
	PRINTL 
	CALL SINGLE_DRAWLINE
ENDIF

PRINTL [  0] 결정
PRINTL [ 10] 추천
PRINTL 

REDRAW 0

$INPUT_LOOP2
INPUT

IF RESULT == 8 && LOCAL:13 > 1
	LOCAL:13 --
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP2
ELSEIF RESULT == 9 && LOCAL:13 < LOCAL:12
	LOCAL:13 ++
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP2
ELSEIF RESULT == 11
	CALL CREATE_SELECTOR_SORT_LIST
	CALL SHOP_LIFE_CHARA_TABLE
	GOTO SHOW_LOOP2
ELSEIF RESULT == 0
	;장을 No의 젊은 순서에 소트
	FOR LOCAL:0, 0, 2
		IF LOCAL:(LOCAL:0 + 4) >= 0
			LOCAL:(LOCAL:0 + 6) = NO:(LOCAL:(LOCAL:0 + 4))
		ELSE
			LOCAL:(LOCAL:0 + 6) = 99999
		ENDIF
	NEXT
	IF LOCAL:6 > LOCAL:7
		SWAP LOCAL:4, LOCAL:5
	ENDIF
	CALL SET_CITY_COMMANDER(ARG:0, 0, LOCAL:4)
	CALL SET_CITY_COMMANDER(ARG:0, 1, LOCAL:5)
	;원으로부터 있던 캐릭터는 아니면, 이 턴에 할당했습니다 플래그를 세운다
	SIF LOCAL:4 >= 0 && LOCAL:4 != 원캐릭터:0 && LOCAL:4 != 원캐릭터:1
		ASSIGNED_THIS_TURN:(LOCAL:4):0 = 1
	SIF LOCAL:5 >= 0 && LOCAL:5 != 원캐릭터:0 && LOCAL:5 != 원캐릭터:1
		ASSIGNED_THIS_TURN:(LOCAL:5):0 = 1
	;이 턴에 할당할 수 있었던 캐릭터는 아니면, 쿨 타임을 부여
	SIF 원캐릭터:0 != -1 && 원캐릭터:0 != LOCAL:4 && 원캐릭터:0 != LOCAL:5 && !ASSIGNED_THIS_TURN:(원캐릭터:0):0
		COOLTIME:(원캐릭터:0):0 = 1
	SIF 원캐릭터:1 != -1 && 원캐릭터:1 != LOCAL:4 && 원캐릭터:1 != LOCAL:5 && !ASSIGNED_THIS_TURN:(원캐릭터:1):0
		COOLTIME:(원캐릭터:1):0 = 1
	REDRAW 1
	RETURN
ELSEIF RESULT == 10
	CALL SET_CITY_COMMANDER_BEST(ARG:0, 1)
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP2
ELSE
	LOCAL:10 = NO_TO_CHARA(RESULT - 99)
	IF LOCAL:10 < 0 || CFLAG:(LOCAL:10):소속 != CITY_OWNER:(ARG:0) || TMP_IS_FREE:(LOCAL:10):0 != 0
		CLEARLINE 1
		GOTO INPUT_LOOP2
	ENDIF

	;이미 선택 끝난 캐릭터라면 선택 해제
	FOR LOCAL:0, 4, 6
		IF LOCAL:(LOCAL:0) == LOCAL:10
			CALL CLEAR_CITY_COMMANDER_FIND(ARG:0, LOCAL:10)
			CLEARLINE LINECOUNT - FIRST_LINE
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	;미선택의 캐릭터는 선택
	FOR LOCAL:0, 4, 6
		IF LOCAL:(LOCAL:0) < 0
			CALL SET_CITY_COMMANDER_ANYWHERE(ARG:0, LOCAL:10)
			CLEARLINE LINECOUNT - FIRST_LINE
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	CLEARLINE 2
	PRINTFORML 장의 수가 최대입니다
ENDIF
GOTO INPUT_LOOP2

;-------------------------------------------------
;ARG:0 세력의 ARG:1번에 부대를 신규 작성
;-------------------------------------------------
@CREATE_UNIT(ARG:0, ARG:1, ARG:2 = 0)
CALL SINGLE_DRAWLINE

SIF ARG:2 != 0
	GOTO POSITIONING_CANCEL

CALL SET_CITY_COLOR_COUNTRY
CALL SET_CITY_COLOR_UNIT
CALL DRAWMAP
CALL RESET_CITY_COLOR
CALL SINGLE_DRAWLINE

PRINTL 부대를 편성하는 도시를 설정해 주세요
PRINTBUTTON " 0[캔슬]", 0
PRINTL 

$INPUT_LOOP0
INPUT

IF RESULT == 0
	RETURN
ELSEIF RESULT >= 1001 && RESULT <= 1001 + CITY_NUM
	LOCAL:5 = RESULT - 1000
	IF CITY_OWNER:(LOCAL:5) == ARG:0
		UNIT_POSITION:(ARG:0):(ARG:1) = LOCAL:5
	ELSE
		CLEARLINE 1
		PRINTL 부대를 편성할 수 있는 것은 자국 영내 뿐입니다
		GOTO INPUT_LOOP0
	ENDIF
ELSE
	GOTO INPUT_LOOP0
ENDIF

$POSITIONING_CANCEL

CALL SINGLE_DRAWLINE
PRINTFORML 부대의 병수를 입력해 주세요(잔존병수:{COUNTRY_SOLDIER:(ARG:0)})

CALL DRAW_SOLDIER_INPUT(COUNTRY_SOLDIER:(ARG:0))

$INPUT_LOOP1
INPUT

IF RESULT <= 0
	UNIT_POSITION:(ARG:0):(ARG:1) = 0
	RETURN
ELSEIF RESULT < 500
	CLEARLINE 1
	PRINTL 최악이어도 500의 병수가 필요합니다
	GOTO INPUT_LOOP1
ELSEIF RESULT <= COUNTRY_SOLDIER:(ARG:0)
	UNIT_SOLDIER:(ARG:0):(ARG:1) = RESULT
	COUNTRY_SOLDIER:(ARG:0) -= RESULT
	PRINTFORMW {ARG:1 + 1}번대의 병수를 {RESULT}로 설정합니다
ELSE
	CLEARLINE 1
	PRINTL 국의 병수가 부족합니다
	GOTO INPUT_LOOP1
ENDIF

UNIT_TARGET:(ARG:0):(ARG:1) = 0
UNIT_COMMANDER:(ARG:0):(ARG:1) = 0

;부대의 장의 설정
CALL SELECT_UNIT_COMMANDER(ARG:0, ARG:1)

RETURN 1

;-------------------------------------------------
;ARG:0 세력의 ARG:1번에 부대에 대해, 장을 설정한다
;-------------------------------------------------
@SELECT_UNIT_COMMANDER(ARG:0, ARG:1)
#DIM 원캐릭터, MAX_UNIT_COMMANDER
#DIM 부대공격
#DIM 부대방어
#DIM 부대지략
#DIM 부대요술
#DIM FIRST_LINE
CALL GET_UNIT_COMMANDER_ALL(ARG:0, ARG:1)
원캐릭터:0 = RESULT:0, RESULT:1, RESULT:2

;사관이 부대에 소속해 있는지 어떤지의 맵을 작성(고속화용)
CALL TMP_CREATE_IS_FREE_MAP

;다만, 현재 그 부대에 소속해 있는 캐릭터에 대해서는, 프리이라고 간주한다（가 아니면 해제했을 때에 선택 할 수 없게 되므로）
FOR LOCAL, 0, 3
	LOCAL:1 = GET_UNIT_COMMANDER(ARG:0, ARG:1, LOCAL)
	SIF LOCAL:1 != -1
		TMP_IS_FREE:(LOCAL:1):0 = 0
NEXT

;페이지수의 계산
LOCAL:20 = 0
FOR LOCAL:0, 0, CHARANUM
	;마스터와 소속 세력이 같은 캐릭터만 카운트
	IF (CFLAG:(LOCAL:0):소속 == ARG:0)
		LOCAL:20 ++
	ENDIF
NEXT
LOCAL:20 = (LOCAL:20 - 1) / 40 + 1
LOCAL:21 = 1
FIRST_LINE = LINECOUNT
$SHOW_LOOP2
CALL GET_UNIT_COMMANDER_ALL(ARG:0, ARG:1)
LOCAL:10 = RESULT:0, RESULT:1, RESULT:2
CALL SET_BATTLE_MIRROR_VAL(0, RESULT:0, RESULT:1, RESULT:2)
부대공격 = ATTACK_LEVEL(0, 0)
부대방어 = DEFENSE_LEVEL(0, 0)
부대지략 = INTELLIGENCE_LEVEL(0, 0)
부대요술 = MAGIC_LEVEL(0, 0)

LOCAL:1 = MAX(GET_DIGIT(부대공격), GET_DIGIT(부대방어), GET_DIGIT(부대지략), GET_DIGIT(부대요술), 6) + 1

CALL SINGLE_DRAWLINE
PRINTFORML 부대의 장을 설정해 주세요(최대 3명까지)
PRINTFORML 임신중（황색)  임월（적색)  육아중(황록)의 사관은 통상보다 약체화 합니다
PRINTFORML 【현재의 부대 능력】
PRINTFORM 공격:
CALL PRINT_ALPHABET_RANK(랭크_부대, 부대공격)
PRINTFORML {부대공격, LOCAL:1}
PRINTFORM 방어:
CALL PRINT_ALPHABET_RANK(랭크_부대, 부대방어)
PRINTFORML {부대방어, LOCAL:1}
PRINTFORM 지략:
CALL PRINT_ALPHABET_RANK(랭크_부대, 부대지략)
PRINTFORML {부대지략, LOCAL:1}
PRINTFORM 요술:
CALL PRINT_ALPHABET_RANK(랭크_부대, 부대요술)
PRINTFORML {부대요술, LOCAL:1}
PRINTBUTTON "[능력일람 표시]", 11
PRINTL
CALL SINGLE_DRAWLINE
PRINTFORM %TOSTR_SPACE(14)%   무|  방|  지|  정|  술|  가|  요 %TOSTR_SPACE(17)%   무|  방|  지|  정|  술|  가|  요
PRINTL 

LOCAL:25 = 15
LOCAL:1 = 0
LOCAL:22 = 0
LOCAL:23 = (LOCAL:21 - 1) * 40
LOCAL:24 = LOCAL:21 * 40
FOR LOCAL:0, 0, CHARANUM
	;마스터와 소속 세력이 같은 캐릭터만
	IF (CFLAG:(LOCAL:0):소속 == ARG:0)
		IF LOCAL:22 >= LOCAL:23 && LOCAL:22 < LOCAL:24
			IF LOCAL:1 % 2 != 0
				PRINT 　　
			ELSEIF LOCAL:1 >= 1
				PRINTL 
				LOCAL:25 ++
			ENDIF
			IF MATCH(LOCAL, LOCAL:0, 10, 13)
				SETCOLOR 칼라_선택중
			ELSEIF CFLAG:LOCAL:행동불능상태 == 행동불능_임월
				SETCOLOR 칼라_경고
			ELSEIF TALENT:LOCAL:임신
				SETCOLOR 칼라_주의
			ELSEIF CFLAG:LOCAL:행동불능상태 == 행동불능_육아
				SETCOLOR 칼라_황록
			ENDIF


			IF TMP_IS_FREE:(LOCAL:0):0 == 0
				PRINTFORM [{NO:(LOCAL:0) + 99, 4}]%SNAME(LOCAL:0), MAX_CHARANAME_LENGTH / 2, RIGHT%
				PRINTFORM    
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):무투)
				PRINTFORM {ABL:(LOCAL:0):무투, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):방위)
				PRINTFORM {ABL:(LOCAL:0):방위, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):지략)
				PRINTFORM {ABL:(LOCAL:0):지략, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):정치)
				PRINTFORM {ABL:(LOCAL:0):정치, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):요술)
				PRINTFORM {ABL:(LOCAL:0):요술, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):가창)
				PRINTFORM {ABL:(LOCAL:0):가창, 3}|
				CALL PRINT_ALPHABET_RANK(랭크_ＳＬＧ, ABL:(LOCAL:0):요리)
				PRINTFORM {ABL:(LOCAL:0):요리, 3}
			ELSE
				LOCALS:0 = [{NO:(LOCAL:0) + 99, 4}]
				LOCALS:0 += @"%SNAME(LOCAL:0), MAX_CHARANAME_LENGTH / 2, RIGHT%"
				IF TMP_IS_FREE:LOCAL:0 == 1
					LOCALS:0 += @" 부"
				ELSEIF TMP_IS_FREE:LOCAL:0 == 2
					LOCALS:0 += @" 수"
				ELSEIF COOLTIME:(LOCAL:0):0
					LOCALS:0 += @" %TOFULL(TOSTR(COOLTIME:(LOCAL:0):0))%"
				ELSEIF TMP_IS_FREE:LOCAL:0 == -1
					LOCALS:0 += @" 외"
				ELSE
					LOCALS:0 += @"   "
				ENDIF

				LOCALS:0 += @"%ALPHABET_RANK(0, ABL:LOCAL:무투)%{ABL:(LOCAL:0):무투, 3}|%ALPHABET_RANK(0, ABL:LOCAL:방위)%{ABL:(LOCAL:0):방위, 3}|%ALPHABET_RANK(0, ABL:LOCAL:지략)%{ABL:(LOCAL:0):지략, 3}|"
				LOCALS:0 += @"%ALPHABET_RANK(0, ABL:LOCAL:정치)%{ABL:(LOCAL:0):정치, 3}|%ALPHABET_RANK(1, ABL:LOCAL:요술)%{ABL:(LOCAL:0):요술, 3}|%ALPHABET_RANK(2, ABL:LOCAL:가창)%{ABL:(LOCAL:0):가창, 3}|%ALPHABET_RANK(2, ABL:LOCAL:요리)%{ABL:(LOCAL:0):요리, 3}"
				SETCOLOR 칼라_선택불가
				PRINTPLAINFORM %LOCALS:0%
			ENDIF
			RESETCOLOR
			LOCAL:1 ++
		ENDIF
		LOCAL:22 ++
	ENDIF
NEXT
PRINTL 
CALL SINGLE_DRAWLINE

IF LOCAL:20 >= 2
	LOCAL:25 += 2
	IF LOCAL:21 > 1
		PRINT [  8] 이전페이지            
	ELSE
		PRINT                             
	ENDIF
	LOCALS:0 = page{LOCAL:21}/{LOCAL:20}
	PRINTPLAINFORM %LOCALS:0, 28, LEFT%
	IF LOCAL:21 < LOCAL:20
		PRINT [  9] 다음페이지
	ENDIF
	PRINTL 
	CALL SINGLE_DRAWLINE
ENDIF

PRINTL [  0] 결정
PRINTL [ 10] 추천
PRINTL 

REDRAW 0

$INPUT_LOOP2
INPUT

IF RESULT == 8 && LOCAL:21 > 1
	LOCAL:21 --
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP2
ELSEIF RESULT == 9 && LOCAL:21 < LOCAL:20
	LOCAL:21 ++
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP2
ELSEIF RESULT == 11
	CALL CREATE_SELECTOR_SORT_LIST
	CALL SHOP_LIFE_CHARA_TABLE
	GOTO SHOW_LOOP2
ELSEIF RESULT == 0
	;장을 No의 젊은 순서에 소트
	FOR LOCAL:0, 0, 3
		IF LOCAL:(LOCAL:0 + 10) >= 0
			LOCAL:(LOCAL:0 + 20) = NO:(LOCAL:(LOCAL:0 + 10))
		ELSE
			LOCAL:(LOCAL:0 + 20) = 99999
		ENDIF
	NEXT
	LOCAL:15 = 1
	WHILE LOCAL:15
		LOCAL:15 = 0
		FOR LOCAL:0, 0, 2
			IF LOCAL:(LOCAL:0 + 20) > LOCAL:(LOCAL:0 + 21)
				SWAP LOCAL:(LOCAL:0 + 10), LOCAL:(LOCAL:0 + 11)
				SWAP LOCAL:(LOCAL:0 + 20), LOCAL:(LOCAL:0 + 21)
				LOCAL:15 = 1
			ENDIF
		NEXT
	WEND

	;장의 등록
	CALL SET_UNIT_COMMANDER(ARG:0, ARG:1, 0, LOCAL:10)
	CALL SET_UNIT_COMMANDER(ARG:0, ARG:1, 1, LOCAL:11)
	CALL SET_UNIT_COMMANDER(ARG:0, ARG:1, 2, LOCAL:12)
	
	;이 턴에 할당한 플래그를 세운다
	SIF LOCAL:10 >= 0 && !GROUPMATCH(LOCAL:10, 원캐릭터:0, 원캐릭터:1, 원캐릭터:2)
		ASSIGNED_THIS_TURN:(LOCAL:10):0 = 1
	SIF LOCAL:11 >= 0 && !GROUPMATCH(LOCAL:11, 원캐릭터:0, 원캐릭터:1, 원캐릭터:2)
		ASSIGNED_THIS_TURN:(LOCAL:11):0 = 1
	SIF LOCAL:12 >= 0 && !GROUPMATCH(LOCAL:12, 원캐릭터:0, 원캐릭터:1, 원캐릭터:2)
		ASSIGNED_THIS_TURN:(LOCAL:12):0 = 1
	
	;이 턴에 할당한 캐릭터는 아니면, 원장의 쿨 타임 설정
	SIF 원캐릭터:0 != -1 && !GROUPMATCH(원캐릭터:0, LOCAL:10, LOCAL:11, LOCAL:12) && !ASSIGNED_THIS_TURN:(원캐릭터:0):0
		COOLTIME:(원캐릭터:0):0 = 1
	SIF 원캐릭터:1 != -1 && !GROUPMATCH(원캐릭터:1, LOCAL:10, LOCAL:11, LOCAL:12) && !ASSIGNED_THIS_TURN:(원캐릭터:1):0
		COOLTIME:(원캐릭터:1):0 = 1
	SIF 원캐릭터:2 != -1 && !GROUPMATCH(원캐릭터:2, LOCAL:10, LOCAL:11, LOCAL:12) && !ASSIGNED_THIS_TURN:(원캐릭터:2):0
		COOLTIME:(원캐릭터:2):0 = 1
	REDRAW 1
	RETURN
;추천 짜맞춤의 탐색
ELSEIF RESULT == 10
	;정치력 높은 캐릭터 필터링을 무시하는 플래그를 세워 둔다
	CALL CHECK_UNIT_COMMANDER_BEST(CFLAG:MASTER:소속, 1)
	CALL SET_UNIT_COMMANDER(ARG:0, ARG:1, 0, UNIT_COMMANDER_BEST:0)
	CALL SET_UNIT_COMMANDER(ARG:0, ARG:1, 1, UNIT_COMMANDER_BEST:1)
	CALL SET_UNIT_COMMANDER(ARG:0, ARG:1, 2, UNIT_COMMANDER_BEST:2)
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP2
ELSE
	LOCAL:5 = NO_TO_CHARA(RESULT - 99)
	IF LOCAL:5 < 0 || CFLAG:(LOCAL:5):소속 != ARG:0 || TMP_IS_FREE:(LOCAL:5):0 != 0
		CLEARLINE 1
		GOTO INPUT_LOOP2
	ENDIF

	;이미 선택 끝난 캐릭터라면 선택 해제
	FOR LOCAL:0, 10, 13
		IF LOCAL:(LOCAL:0) == LOCAL:5
			CALL CLEAR_UNIT_COMMANDER_FIND(ARG:0, ARG:1, LOCAL:5)
			CLEARLINE LINECOUNT - FIRST_LINE
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	;미선택의 캐릭터는 선택
	FOR LOCAL:0, 10, 13
		IF LOCAL:(LOCAL:0) < 0
			CALL SET_UNIT_COMMANDER_ANYWHERE(ARG:0, ARG:1, LOCAL:5)
			CLEARLINE LINECOUNT - FIRST_LINE
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	CLEARLINE 2
	PRINTFORML 장의 수가 최대입니다
ENDIF
GOTO INPUT_LOOP2

;-------------------------------------------------
;병 수입력 버튼의 묘화 ARG:0=설정치의 최대
;-------------------------------------------------
@DRAW_SOLDIER_INPUT(ARG:0)
PRINTL [     0]
IF ARG:0 >= 500
	PRINT [   500]
ENDIF
LOCAL:1 = MIN(10, ARG:0 / 1000 + 1)
FOR LOCAL:0, 1, LOCAL:1
	PRINTFORM [{LOCAL:0 * 1000, 6}]
NEXT
PRINTL 
IF ARG:0 >= 10000
	LOCAL:1 = MIN(10, (ARG:0 - 10000) / 2000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 2000 + 10000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 30000
	LOCAL:1 = MIN(10, (ARG:0 - 30000) / 5000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 5000 + 30000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 80000
	LOCAL:1 = MIN(10, (ARG:0 - 80000) / 10000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 10000 + 80000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 200000
	LOCAL:1 = MIN(10, (ARG:0 - 200000) / 50000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 50000 + 200000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 700000
	LOCAL:1 = MIN(9, (ARG:0 - 700000) / 100000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 100000 + 700000}]
	NEXT
	PRINTL 
ENDIF
PRINTBUTTON "[나머지 모두]", ARG:0

;-------------------------------------------------
;경제력 입력 버튼의 묘화 ARG:0=설정치의 최대
;-------------------------------------------------
@DRAW_ECONOMY_INPUT(ARG:0)
PRINTL [     0]
IF ARG:0 >= 50
	PRINT [    50]
ENDIF
LOCAL:1 = MIN(10, ARG:0 / 100 + 1)
FOR LOCAL:0, 1, LOCAL:1
	PRINTFORM [{LOCAL:0 * 100, 6}]
NEXT
PRINTL 
IF ARG:0 >= 1000
	LOCAL:1 = MIN(10, (ARG:0 - 1000) / 200 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 200 + 1000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 3000
	LOCAL:1 = MIN(10, (ARG:0 - 3000) / 500 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 500 + 3000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 8000
	LOCAL:1 = MIN(10, (ARG:0 - 8000) / 1000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 1000 + 8000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 20000
	LOCAL:1 = MIN(10, (ARG:0 - 20000) / 5000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 5000 + 20000, 6}]
	NEXT
	PRINTL 
ENDIF
IF ARG:0 >= 70000
	LOCAL:1 = MIN(9, (ARG:0 - 70000) / 10000 + 1)
	FOR LOCAL:0, 0, LOCAL:1
		PRINTFORM [{LOCAL:0 * 10000 + 70000}]
	NEXT
	PRINTL 
ENDIF
PRINTBUTTON "[경제력의20%]", ARG:0

;-------------------------------------------------
;최강 설정으로부터 제외하는 캐릭터를 지정
;-------------------------------------------------
@EXCLUDE_BEST_COMMANDER
#DIM FIRST_LINE
#DIM 소거행
#DIM 대상
#DIM 표시위치
#DIM 표시페이지
#DIM 총페이지수
#DIM 캐릭터수
#DIM 캐릭터카운터
#DIM 표시개시위치
#DIM 표시종료위치
VARSET 캐릭터수
FOR LOCAL, 0, CHARANUM
	SIF CFLAG:(LOCAL:0):소속 == CFLAG:MASTER:소속
		캐릭터수 ++
NEXT

총페이지수 = (캐릭터수 - 1) / 40 + 1
표시페이지 = 1


CALL SINGLE_DRAWLINE
PRINTFORML 부대편성·수장설정에 있어서의 「추천 편성」으로부터 제외하는 캐릭터를 설정할 수 있습니다
PRINTFORML 클릭으로 타글·제외된 캐릭터는 분홍색 표시됩니다
CALL SINGLE_DRAWLINE
FIRST_LINE = LINECOUNT
$SHOW_LOOP


VARSET 표시위치
VARSET 캐릭터카운터
표시개시위치 = (표시페이지 - 1) * 40
표시종료위치 = 표시페이지 * 40

FOR LOCAL:0, 0, CHARANUM
	IF CFLAG:(LOCAL:0):소속 == CFLAG:MASTER:소속
		IF 표시개시위치 <= 캐릭터카운터 && 캐릭터카운터 <= 표시종료위치
			IF 표시위치 % 3 != 0
				PRINT 　　
			ELSEIF 표시위치 > 0
				PRINTL
			ENDIF
			IF CFLAG:(LOCAL:0):최강편성제외플래그
				SETCOLOR 칼라_핑크
			ELSE
				RESETCOLOR
			ENDIF
			PRINTFORM [{LOCAL:0 + 99, 4}]%ANAME(LOCAL:0), 16, RIGHT%
			표시위치 ++
		ENDIF
		캐릭터카운터 ++
	ENDIF
NEXT
RESETCOLOR
PRINTL
CALL SINGLE_DRAWLINE

IF 총페이지수 >= 2
	소거행 += 2
	IF 표시페이지 > 1
		PRINT [  8] 이전페이지            
	ELSE
		PRINT                             
	ENDIF
	LOCALS:0 = 페이지{표시페이지}/{총페이지수}
	PRINTPLAINFORM %LOCALS:0, 28, LEFT%
	IF 표시페이지 < 총페이지수
		PRINT [  9] 다음페이지
	ENDIF
	PRINTL 
	CALL SINGLE_DRAWLINE
ENDIF

PRINTL [ 0]이것으로 좋아
REDRAW 0
INPUT
IF RESULT == 8 && 표시페이지 > 1
	표시페이지 --
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ELSEIF RESULT == 9 && 표시페이지 < 총페이지수
	표시페이지 ++
	CLEARLINE 소거행
	GOTO SHOW_LOOP
ELSEIF RESULT == 0
	REDRAW 1
	RETURN -1
ENDIF
대상 = RESULT - 99
IF 대상 > CHARANUM || 대상 < 0 || CFLAG:대상:소속 != CFLAG:MASTER:소속
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ENDIF

CFLAG:대상:최강편성제외플래그 = !CFLAG:대상:최강편성제외플래그
CLEARLINE LINECOUNT - FIRST_LINE
GOTO SHOW_LOOP


;-------------------------------------------------
;부대에 군사를 일괄 보충
;-------------------------------------------------
@UNIT_SOLDIER_REPLENISH(ARG:0)
#DIM 보충가능부대수
#DIM FIRST_LINE
#DIM 보충병수
#DIM 끝수
보충가능부대수 = 0
FOR LOCAL, 0, MAX_UNIT
	SIF UNIT_SOLDIER:(ARG:0):LOCAL <= 0
		CONTINUE
	;부대가 있는 도시의 세력과의 관계를 취득
	CALL CHECK_COUNTRY_RELATION(ARG:0, CITY_OWNER:(UNIT_POSITION:(ARG:0):(LOCAL:0)))
	LOCAL:1 = RESULT:0
	SIF IS_STAY_ENEMY_UNIT(UNIT_POSITION:(ARG:0):(LOCAL:0))
		LOCAL:1 = 0
	SIF LOCAL:1
		보충가능부대수 ++
NEXT

IF 보충가능부대수 == 0
	PRINTFORMW 보충 가능한 부대가 없습니다
	RETURN 
ENDIF

FIRST_LINE = LINECOUNT

$SHOW_LOOP

CALL SINGLE_DRAWLINE
PRINTFORML 보충 가능한 부대에 군사를 일괄로 보충합니다
PRINTFORML 보충하는 병수를 입력해 주세요(0 이하로 캔슬)
PRINTFORML 현재 할당하고 가능한 병수:{COUNTRY_SOLDIER:(ARG:0)}
CALL SINGLE_DRAWLINE

PRINTBUTTON "[가능할 뿐(만큼) 보충]", COUNTRY_SOLDIER:(ARG:0)

INPUT

SIF RESULT <= 0
	RETURN
IF RESULT > COUNTRY_SOLDIER:(ARG:0)
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ENDIF

보충병수 = RESULT
끝수 = 보충병수 % 보충가능부대수
보충병수 -= 끝수

LOCAL:2 = 0

FOR LOCAL, 0, MAX_UNIT
	SIF UNIT_SOLDIER:(ARG:0):LOCAL <= 0
		CONTINUE
	;부대가 있는 도시의 세력과의 관계를 취득
	CALL CHECK_COUNTRY_RELATION(ARG:0, CITY_OWNER:(UNIT_POSITION:(ARG:0):(LOCAL:0)))
	LOCAL:1 = RESULT:0
	SIF IS_STAY_ENEMY_UNIT(UNIT_POSITION:(ARG:0):(LOCAL:0))
		LOCAL:1 = 0
	IF LOCAL:1
		UNIT_SOLDIER:(ARG:0):LOCAL += 보충병수 / 보충가능부대수
		COUNTRY_SOLDIER:(ARG:0) -= 보충병수 / 보충가능부대수
		보충병수 -=  보충병수 / 보충가능부대수
		IF LOCAL:2 == 0
			UNIT_SOLDIER:(ARG:0):LOCAL += 끝수
			보충병수 -= 끝수
			LOCAL:2 = 1
		ENDIF
	ENDIF
NEXT

PRINTFORMW 보충했습니다
RETURN 
