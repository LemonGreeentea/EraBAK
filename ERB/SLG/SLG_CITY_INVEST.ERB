@CITY_INVEST(도시)
#DIM 도시
#DIM 투자액
#DIM 효과
#DIM 성장전
#DIM 정치력

CALL SINGLE_DRAWLINE
PRINTFORML 아무리 투자합니까? (0으로 캔슬)
PRINTFORML 현재의 국고:{MONEY:(CFLAG:MASTER:소속)}

$INPUT_LOOP

INPUT

IF RESULT <= 0
	RETURN 0
ELSEIF !INRANGE(RESULT, 0, MONEY:(CFLAG:MASTER:소속))
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF

투자액 = RESULT
성장전 = CITY_ECONOMY:도시

MONEY:(CFLAG:MASTER:소속) -= 투자액
CALL TMP_CREATE_IS_FREE_MAP
정치력 = TMP_GET_POLITICS_POWER(CFLAG:MASTER:소속)

효과 = CALC_CITY_INVEST_EFFECT(도시, 투자액, 정치력)

CITY_ECONOMY:도시 += 효과
CITY_ECONOMY_LIMIT:도시 = MAX(CITY_ECONOMY_LIMIT:도시, CITY_ECONOMY:도시)

PRINTFORML %CITY_NAME:도시%에{투자액}의 투자를 실시했습니다
PRINTFORMW 경제가 {효과 / 100} 성장했습니다

NOW_INVEST ++

RETURN 1

@CALC_MAX_INVEST()
#FUNCTION
RETURNF GET_OWN_CITY(CFLAG:MASTER:소속) / 5 + 1

@CALC_CITY_INVEST_EFFECT(도시, 투자액, 정치력)
#FUNCTION
#DIM 세력
#DIM 도시
#DIM 효과
#DIM 정치력
#DIM 투자액
#DIM 잉여분

;계산
DUMPRAND
효과 = MAX(투자액 * SQRT(정치력) * RAND(80, 120) / 10000, 10)
INITRAND

SIF CITY_ECONOMY:도시 > 100000
	효과 /= 3

IF CITY_ECONOMY:도시 + 효과 > CITY_ECONOMY_LIMIT:도시
	잉여분 = CITY_ECONOMY:도시 + 효과 - CITY_ECONOMY_LIMIT:도시
	효과 = 효과 - 잉여분 + 잉여분 / 5
ENDIF

RETURNF 효과
