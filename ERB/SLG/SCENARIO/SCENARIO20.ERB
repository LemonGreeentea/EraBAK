;-------------------------------------------------
;시나리오 20
;영웅집결
;-------------------------------------------------
@SCENARIO_NAME_20
RESULTS = 영웅집결
RETURN

@SCENARIO_INTRO_20
PRINTFORML
PRINTFORML 지금, 환상향에서 어딘가의 누군가가 여러명 일어섰다!
PRINTFORML 목표로 하고는 환상향 통일. 동료는 0.
PRINTFORML 동료를 모아 환상향을 통일하는 것은 과연 어디의 누군가…….
PRINTFORML 어떻게 되는 환상향!
PRINTFORML
PRINTFORML ※군주와 초기 영지(1개소)가 랜덤으로 선택되는 시나리오입니다
PRINTFORMW
PRINTL

;랜덤 캐릭터는 선택에 맡긴다
FLAG:OP랜덤캐릭터사용 = 0

@SCENARIO_MAPSELECT_20
PRINTFORML
PRINTFORML 어느 맵으로 플레이 합니까?
CALL ASK_MULTI("Default", "일본", "유럽")
SELECTCASE RESULT
	CASE 0
		MAPID '= "DEFAULT"
	CASE 1
		MAPID '= "JAPAN"
	CASE 2
		MAPID '= "EU"
ENDSELECT

@SCENARIO_PLACEMENT_20
#DIM 세력수
#DIM 배분
COUNTRY_BOSS:0 = 0
COUNTRY_COLOR:0 = GETDEFCOLOR()


CALL ASK_YN("구작 캐릭터도 군주가 될 수 있다", "구작 캐릭터는 군주가 되지 않는다")
SCVAR:0 = RESULT

CALL ASK_MULTI("세력수 보통", "세력수 많음", "세력수 적음")
SELECTCASE RESULT
	CASE 0
		세력수 = 12 + RAND:5 + RAND:5 + RAND:5
	CASE 1
		세력수 = MIN(18 + RAND:7 + RAND:7 + RAND:7, MAX_COUNTRY - 2)
	CASE 2
		세력수 = 6 + RAND:3 + RAND:3 + RAND:3
ENDSELECT

PRINTFORML 군주에 「하고 싶지 않는」캐릭터를 선택
CALL SELECT_CHARA_LIST_MULTI_ONLY_LOGIC_SLG(50, "NONE", "NONE")

CALL FISHER_YATES_SHAFFLE(CHARANUM)
VARSET 배분

;군주의 설정
FOR LOCAL, 0, CHARANUM
	LOCAL:1 = SHAFFLE_ARRAY:LOCAL
	SIF !IS_FIXED_CHARA(LOCAL:1)
		CONTINUE
	SIF FINDELEMENT(SELECTED_CHARA, LOCAL:1) != -1
		CONTINUE
	SIF LOCAL:1 == NAME_TO_CHARA("당신")
		CONTINUE
	SIF SCVAR:0 && TALENT:(LOCAL:1):캐릭터구분
		CONTINUE
	COUNTRY_BOSS:(배분 + 1) = GET_ID(LOCAL:1)
	CALL CHANGE_COUNTRY(LOCAL:1, 배분 + 1, 1)
	배분 ++
	SIF 배분 == 세력수
		BREAK
NEXT


CALL FISHER_YATES_SHAFFLE(GET_CITY_NUM() + 1)
;초기 도시의 설정
FOR LOCAL, 1, 세력수 + 1
	FOR LOCAL:1, 0, GET_CITY_NUM() + 1
		LOCAL:2 = SHAFFLE_ARRAY:(LOCAL:1)
		SIF LOCAL:2 == 0 || CITY_OWNER:(LOCAL:2) != 0
			CONTINUE
		CITY_OWNER:(LOCAL:2) = LOCAL
		BREAK
	NEXT
NEXT

;세력의 작성
FOR LOCAL, 1, 세력수 + 1
	COUNTRY_COLOR:LOCAL = CHARA_COUNTRY_COLOR(GET_COUNTRY_BOSS(LOCAL))
	CALL SP_COUNTRY_RISE(LOCAL)
NEXT

VARSET CITY_OWNER

CALL FISHER_YATES_SHAFFLE(GET_CITY_NUM() + 1)
;초기 도시의 설정
FOR LOCAL, 1, 세력수 + 1
	FOR LOCAL:1, 0, GET_CITY_NUM() + 1
		LOCAL:2 = SHAFFLE_ARRAY:(LOCAL:1)
		SIF LOCAL:2 == 0 || CITY_OWNER:(LOCAL:2) != 0
			CONTINUE
		CITY_OWNER:(LOCAL:2) = LOCAL
		BREAK
	NEXT
NEXT


FOR LOCAL, 1, 세력수 + 1
	COUNTRY_SOLDIER:LOCAL = 8000
NEXT

;지정되지 않았던 캐릭터는 방랑 「당신」는 제외（MASTER 바꿔 넣었을 때에 방랑하는 것을 막는다）.
FOR LOCAL:0, 1, CHARANUM
	SIF CFLAG:(LOCAL:0):1 == 0  && CSTR:(LOCAL:0):99 != "당신"
		CFLAG:(LOCAL:0):특수상태 = 특수상태_방랑
NEXT



FOR LOCAL, 1, GET_CITY_NUM() + 1
	SIF !IS_COUNTRY(CITY_OWNER:LOCAL)
		CONTINUE
	SIF CITY_ECONOMY_LIMIT:LOCAL <= 100000
		CITY_ECONOMY_LIMIT:LOCAL = 100000
	CITY_ECONOMY:LOCAL = MIN(CITY_ECONOMY_LIMIT:LOCAL, 100000)
NEXT


FOR LOCAL, 0, MAX_COUNTRY
	SIF !IS_COUNTRY(CITY_OWNER:LOCAL)
		CONTINUE
	COUNTRY_SOLDIER:LOCAL = 8000
	MONEY:LOCAL = 5000
NEXT

;무소속 도시의 병수는 경제의 7.5%
FOR LOCAL:0, 0, MAX_CITY
	SIF CITY_OWNER:(LOCAL:0) == 0
		CITY_SOLDIER:(LOCAL:0) = CITY_ECONOMY:(LOCAL:0) * 75 / 1000
NEXT

;■관계 설정
CALL SHARED_SETTING_RELATION

;도시 나름으로는 초반 막히므로 용돈
FOR LOCAL:0, 0, MAX_COUNTRY
	SIF IS_COUNTRY(LOCAL)
		MONEY:LOCAL += 10000
NEXT

