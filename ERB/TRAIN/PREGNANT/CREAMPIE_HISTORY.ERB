;---------------------------------------------------------
;질내사정 이력을 갱신하는 함수
;낡아진 이력을 삭제한다
;---------------------------------------------------------
@UPDATE_CREAMPIE_HISTORY(ARG)
#DIM LCOUNT
FOR LCOUNT, 0, WOMB_RECORD_MAX
	SIF WOMB_SEMEN_ID:ARG:LCOUNT == 0
		CONTINUE
	;최종 질내사정일부터의 기간을 가산
	WOMB_SEMEN_TIME:ARG:LCOUNT ++

	;회수가 많으면 줄어들어 가는 처리
	IF WOMB_SEMEN_COUNT:ARG:LCOUNT > 5
		LOCAL:1 = RAND:(WOMB_SEMEN_COUNT:ARG:LCOUNT / 3 + 1)
		WOMB_SEMEN_COUNT:ARG:LCOUNT -= LOCAL:1
		WOMB_SEMEN_AMOUNT:ARG:LCOUNT = MIN_DECREASE(WOMB_SEMEN_AMOUNT:ARG:LCOUNT, LOCAL:1 * 2, WOMB_SEMEN_COUNT:ARG:LCOUNT * 3 / 2)
	ENDIF

	;이력이 낡으면 리스트로부터 삭제
	IF 	WOMB_SEMEN_TIME:ARG:LCOUNT >= 5
		WOMB_SEMEN_ID:ARG:LCOUNT = 0
		WOMB_SEMEN_AMOUNT:ARG:LCOUNT = 0
		WOMB_SEMEN_TIME:ARG:LCOUNT = 0
		WOMB_SEMEN_COUNT:ARG:LCOUNT = 0
	ENDIF
NEXT

;---------------------------------------------------------
;부친 후보를 이력으로부터 찾는 함수
;임신하고 있는 시점에서 부친은 있을 것으로 후보가 0명인 경우는 일단 에러를 던져 부친이 불명이라는 일로 한다
;RETURNF CASE
	;0:후보가 복수 따위 후보가 1명이 아닌 경우
	;else:부친 후보의 번호
;---------------------------------------------------------
@GET_FATHER_CANDIDATE_FROM_CREAMPIE_HISTORY(ARG)
#FUNCTION
#DIM FATHER_CANDIDATE, WOMB_RECORD_MAX
#DIM SEMEN_AMOUNT_SUM
#DIM CANDIDATE_COUNT
#DIM CANDIDATE_CNO
#DIM CANDIDATE_VALUE
#DIM LCOUNT
VARSET CANDIDATE_COUNT
VARSET FATHER_CANDIDATE
VARSET SEMEN_AMOUNT_SUM

FOR LCOUNT, 0, WOMB_RECORD_MAX
	SIF WOMB_SEMEN_ID:ARG:LCOUNT == 0
		CONTINUE
	CANDIDATE_CNO = ID_TO_CHARA(WOMB_SEMEN_ID:ARG:LCOUNT)
	FATHER_CANDIDATE:CANDIDATE_COUNT = WOMB_SEMEN_ID:ARG:LCOUNT
	IF CANDIDATE_CNO >= 0
		SEMEN_AMOUNT_SUM += WOMB_SEMEN_AMOUNT:ARG:LCOUNT * (GETBIT(TALENT:CANDIDATE_CNO:음란계, 소질_음란_진한정액) + 1)
	ELSE
		SEMEN_AMOUNT_SUM += WOMB_SEMEN_AMOUNT:ARG:LCOUNT
	ENDIF
	CANDIDATE_COUNT ++
NEXT

SIF CANDIDATE_COUNT == 0
	CALLF ERROR

;부친이 복수 있는 경우는 랜덤으로 한다
;SIF CANDIDATE_COUNT != 1
;	RETURNF 0

IF CANDIDATE_COUNT == 1 || RAND:CANDIDATE_COUNT > 0
	CANDIDATE_VALUE = RAND:SEMEN_AMOUNT_SUM
	FOR LCOUNT, 0, WOMB_RECORD_MAX
		CANDIDATE_CNO = ID_TO_CHARA(WOMB_SEMEN_ID:ARG:LCOUNT)
		IF CANDIDATE_CNO >= 0
			CANDIDATE_VALUE -= WOMB_SEMEN_AMOUNT:ARG:LCOUNT * (GETBIT(TALENT:CANDIDATE_CNO:음란계, 소질_음란_진한정액) + 1)
		ELSE
			CANDIDATE_VALUE -= WOMB_SEMEN_AMOUNT:ARG:LCOUNT
		ENDIF
		SIF CANDIDATE_VALUE <= 0
			RETURNF WOMB_SEMEN_ID:ARG:LCOUNT
	NEXT
;부친 후보가 복수 있는 경우, (후보의 수 - 1/후보의 수)의 확률로 불명하게 된다
ELSE
	RETURNF GET_SPERM_ID("불명")
ENDIF
PRINTFORML 여기에 왔다
;죽어 분기
RETURNF GET_SPERM_ID("불명")

;---------------------------------------------------------
;중이고 이력을 삭제하는 함수
;---------------------------------------------------------
@CLEAR_CREAMPIE_HISTORY(ARG:0)
;질내사정 이력을 클리어
FOR LOCAL, 0, WOMB_RECORD_MAX
	WOMB_SEMEN_ID:(ARG:0):LOCAL = 0
	WOMB_SEMEN_AMOUNT:(ARG:0):LOCAL = 0
	WOMB_SEMEN_COUNT:(ARG:0):LOCAL = 0
	WOMB_SEMEN_TIME:(ARG:0):LOCAL = 0
NEXT