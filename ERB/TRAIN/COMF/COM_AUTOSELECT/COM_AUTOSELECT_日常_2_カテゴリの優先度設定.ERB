;-------------------------------------------------
;# COM_AUTOSELECT_N_2_카테고리의 우선도 설정
;	MAIN_TARGET는 MASTER를 일단 건네주고 있다
;-------------------------------------------------
@COM_AUTOSELECT_N_SET_CATEGORY_PRIORITY(MAIN_PLAYER, MAIN_TARGET)
#DIM MAIN_PLAYER
#DIM MAIN_TARGET
#DIM L_COUNTER
#DIM L_COUNTER_CHECK

;-------------------------------------------------
; 리셋트
;-------------------------------------------------
VARSET COM_AUTO_CATEGORY_PRIORITY, 0

;-------------------------------------------------
; # 공허
;-------------------------------------------------
IF TALENT:MAIN_PLAYER:공허
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 100
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
;-------------------------------------------------
; # CATEGORY_1_LIKE_0
;-------------------------------------------------
ELSEIF CFLAG:MAIN_PLAYER:호감도 < 300
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 100
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
;-------------------------------------------------
; # CATEGORY_2_LIKE_300
;-------------------------------------------------
ELSEIF CFLAG:MAIN_PLAYER:호감도 < 500
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 90
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 10
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
;-------------------------------------------------
; # CATEGORY_3_LIKE_500
;-------------------------------------------------
ELSEIF CFLAG:MAIN_PLAYER:호감도 < 800
	;남끼리는 아닌, 혹은, 바이이다
	IF !IS_SAMESEX_M(MASTER, MAIN_PLAYER) || TALENT:MAIN_PLAYER:바이
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 60
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 20
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 10
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
	ELSE
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 60
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 30
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
	ENDIF
;-------------------------------------------------
; # CATEGORY_4_LIKE_800
;-------------------------------------------------
ELSEIF CFLAG:MAIN_PLAYER:호감도 < 1500
	IF !IS_SAMESEX_M(MASTER, MAIN_PLAYER) || TALENT:MAIN_PLAYER:바이
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 40
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 40
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 15
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 5
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
	ELSE
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 50
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 45
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 5
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
	ENDIF
;-------------------------------------------------
; # CATEGORY_5_LIKE_1500
;-------------------------------------------------
ELSE
	IF TALENT:MAIN_PLAYER:정실 || TALENT:MAIN_PLAYER:첩 || IS_MASTER_UP(MAIN_PLAYER)
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 10
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 30
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 30
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 20
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 10
	ELSEIF TALENT:MAIN_PLAYER:연인 || TALENT:MAIN_PLAYER:낙인
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 10
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 30
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 35
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 15
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 10
	ELSEIF TALENT:MAIN_PLAYER:연모 || TALENT:MAIN_PLAYER:복종 || TALENT:MAIN_PLAYER:주인
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 15
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 30
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 30
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 15
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 5
	ELSE
		IF !IS_SAMESEX_M(MASTER, MAIN_PLAYER) || TALENT:MAIN_PLAYER:바이
			COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 40
			COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 40
			COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 10
			COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 10
			COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
		ELSE
			IF PALAM:MAIN_PLAYER:취기 > 3000
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 40
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 40
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 10
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 10
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
			ELSE
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = 50
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 40
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 10
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
				COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
			ENDIF
		ENDIF
	ENDIF
ENDIF

;기분 보정
IF GROUPMATCH(TOSTR_EMOTION(MAIN_PLAYER), "우울", "슬픔", "암울", "원한", "분노", "분개")
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 += 100
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = 0
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = 0
ELSEIF GROUPMATCH(TOSTR_EMOTION(MAIN_PLAYER), "기쁨", "행복")
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 += 30
	IF COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 != 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 += 30
	ENDIF
	IF COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 != 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 += 5
	ENDIF
ELSEIF TOSTR_EMOTION(MAIN_PLAYER) == "양호"
	COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 += 10
	IF COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 != 0
		COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 += 10
	ENDIF
ENDIF

;각 카테고리의 우선도를 최저치 이상으로 한다
COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 = MAX(COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_0 , 2)
COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 = MAX(COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_300 , 0)
COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 = MAX(COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_500 , 0)
COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 = MAX(COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_800 , 0)
COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 = MAX(COM_AUTO_CATEGORY_PRIORITY:COM_AUTO_CATEGORY_LIKE_1500 , 0)

;카테고리의 예약이 있었을 경우, 그 카테고리의 선택율을 큰폭으로 상승
IF TFLAG:30 >= 1 && COM_AUTO_CATEGORY_PRIORITY:(TFLAG:30) > 0
	COM_AUTO_CATEGORY_PRIORITY:(TFLAG:30) += 10000
ENDIF

[IF_DEBUG]
	DEBUGPRINTFORML  각 카테고리 선택율의 표시
	FOR L_COUNTER, 1, 10
		IF COM_AUTO_CATEGORY_PRIORITY:L_COUNTER > 0
			DEBUGPRINTFORML {L_COUNTER, 4}. %COM_AUTO_N_COM_CATEGORY_NAME(L_COUNTER), 26, LEFT%. %NUM_FORMAT(COM_AUTO_CATEGORY_PRIORITY:L_COUNTER), 10, RIGHT%
		ENDIF
	NEXT
[ENDIF]

RETURN 0
