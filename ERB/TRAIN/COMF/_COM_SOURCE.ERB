;커맨드 관계의 공통 함수(특히 소스에 관련되는 것)를 정리한다

;-------------------------------------------------
;주도권에 응한 우월·굴종의 소스를 가산하는 함수
;ARG:0=캐릭터 번호, ARG:1=우월의 가산치, ARG:2=굴종의 가산치
;-------------------------------------------------
@ADD_SOURCE_INITIATIVE_U(ARG:0, ARG:1, ARG:2)
;주도권을 체크
SELECTCASE GET_COM_INITIATIVE()
	;주도권이 플레이어측
	CASE 0
		;ARG:0번의 캐릭터가 플레이어측
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 0
		ELSE
			LOCAL:3 = 2
		ENDIF
	;주도권이 타겟측
	CASE 1
		;ARG:0번의 캐릭터가 플레이어측
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 2
		ELSE
			LOCAL:3 = 0
		ENDIF
	;주도권이 양쪽 모두
	CASE 2
		LOCAL:3 = 1
	;주도권이 어느 쪽에도 없다
	CASE 3
		LOCAL:3 = 3
ENDSELECT

;주도권이 양쪽 모두·어느 쪽에도 없는 상황에서는 소스 반감
IF LOCAL:3 == 1 || LOCAL:3 == 3
	LOCAL:0 = 2
ELSE
	LOCAL:0 = 1
ENDIF

;ARG:0번의 캐릭터가 주도권을 가진다
IF LOCAL:3 == 0 || LOCAL:3 == 1
	SOURCE:(ARG:0):우월 += ARG:1 / LOCAL:0
ELSE
	SOURCE:(ARG:0):굴종 += ARG:2 / LOCAL:0
ENDIF

;-------------------------------------------------
;주도권에 응한 주도·수동의 소스를 가산하는 함수
;ARG:0=캐릭터 번호, ARG:1=주도의 가산치, ARG:2=수동의 가산치
;-------------------------------------------------
@ADD_SOURCE_INITIATIVE_N(ARG:0, ARG:1, ARG:2)
;주도권을 체크
SELECTCASE GET_COM_INITIATIVE()
	;주도권이 플레이어측
	CASE 0
		;ARG:0번의 캐릭터가 플레이어측
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 0
		ELSE
			LOCAL:3 = 2
		ENDIF
	;주도권이 타겟측
	CASE 1
		;ARG:0번의 캐릭터가 플레이어측
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 2
		ELSE
			LOCAL:3 = 0
		ENDIF
	;주도권이 양쪽 모두
	CASE 2
		LOCAL:3 = 1
	;주도권이 어느 쪽에도 없다
	CASE 3
		LOCAL:3 = 3
ENDSELECT

;주도권이 양쪽 모두·어느 쪽에도 없는 상황에서는 소스 반감
IF LOCAL:3 == 1 || LOCAL:3 == 3
	LOCAL:0 = 2
ELSE
	LOCAL:0 = 1
ENDIF

;ARG:0번의 캐릭터가 주도권을 가진다
IF LOCAL:3 == 0 || LOCAL:3 == 1
	SOURCE:(ARG:0):주도 += ARG:1 / LOCAL:0
ELSE
	SOURCE:(ARG:0):수동 += ARG:2 / LOCAL:0
ENDIF

;-------------------------------------------------
;호감도에 응한 환락의 소스를 가산하는 함수
;ARG:0=캐릭터 번호, ARG:1=배율
;-------------------------------------------------
@ADD_SOURCE_KANRAKU(ARG:0, ARG:1)
IF CFLAG:(ARG:0):2 < 100
	LOCAL:0 = MAX(CFLAG:(ARG:0):2 * 20 / 100, 0)
ELSEIF CFLAG:(ARG:0):2 < 300
	LOCAL:0 = 20 + (CFLAG:(ARG:0):2 - 100) * 10 / 200
ELSEIF CFLAG:(ARG:0):2 < 500
	LOCAL:0 = 30 + (CFLAG:(ARG:0):2 - 300) * 10 / 200
ELSEIF CFLAG:(ARG:0):2 < 800
	LOCAL:0 = 40 + (CFLAG:(ARG:0):2 - 500) * 10 / 300
ELSEIF CFLAG:(ARG:0):2 < 1500
	LOCAL:0 = 50 + (CFLAG:(ARG:0):2 - 800) * 10 / 700
ELSEIF CFLAG:(ARG:0):2 < 5000
	LOCAL:0 = 60 + (CFLAG:(ARG:0):2 - 1500) * 10 / 4500
ELSEIF CFLAG:(ARG:0):2 < 55000
	LOCAL:0 = 70 + (CFLAG:(ARG:0):2 - 5000) * 20 / 50000
ELSE
	LOCAL:0 = 90 + (CFLAG:(ARG:0):2 - 55000) / 20000
ENDIF

LOCAL:0 = MAX(LOCAL:0, 0)

;설정된 배율에 응한 보정을 하는 도중 환락의 소스를 추가
SOURCE:(ARG:0):환락 += LOCAL:0 * ARG:1 / 100

;-------------------------------------------------
;호감도에 응한 애정의 소스를 가산하는 함수
;ARG:0=캐릭터 번호, ARG:1=배율
;-------------------------------------------------
@ADD_SOURCE_AIZYOU(ARG:0, ARG:1)
LOCAL:1 = CFLAG:(ARG:0):2
IF LOCAL:1 < 100
	LOCAL:0 = MAX(LOCAL:1 / 50, 0)
ELSEIF LOCAL:1 < 300
	LOCAL:0 = 10 + (LOCAL:1 - 100) / 20
ELSEIF LOCAL:1 < 500
	LOCAL:0 = 30 + (LOCAL:1 - 300) / 20
ELSEIF LOCAL:1 < 800
	LOCAL:0 = 50 + (LOCAL:1 - 500) / 30
ELSEIF LOCAL:1 < 1500
	LOCAL:0 = 70 + (LOCAL:1 - 800) / 35
ELSEIF LOCAL:1 < 5000
	LOCAL:0 = 100 + (LOCAL:1 - 1500) / 100
ELSEIF LOCAL:1 < 55000
	LOCAL:0 = 135 + (LOCAL:1 - 5000) / 500
ELSE
	LOCAL:0 = 235 + (LOCAL:1 - 55000) / 20000
ENDIF

;설정된 배율에 응한 보정을 하는 도중 애정의 소스를 추가
SOURCE:(ARG:0):애정 += LOCAL:0 * ARG:1 / 100

;-------------------------------------------------
;쾌감계 소스에 필요한 보정을 건 값을 돌려주는 함수(Ｐ이외에의 봉사계)
;ARG:0=봉사측의 캐릭터 번호, ARG:1=상대의 캐릭터 번호, ARG:2=쾌감 소스의 기본치
;-------------------------------------------------
@SENSE_HOUSHI(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.5
	CASE 1
		TIMES LOCAL:0, 0.75
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.25
	CASE 4
		TIMES LOCAL:0, 1.50
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 4 + 154) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.04
	CASE 2
		TIMES LOCAL:0, 1.08
	CASE 3
		TIMES LOCAL:0, 1.12
	CASE 4
		TIMES LOCAL:0, 1.16
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 120) / 100
ENDSELECT

;봉사 대상이 주인공의 경우
IF ARG:1 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):친애 || TALENT:(ARG:0):예속 || TALENT:(ARG:0):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):연모 || TALENT:(ARG:0):복종 || TALENT:(ARG:0):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8
;주인공에 의한 봉사의 경우
ELSEIF ARG:0 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):친애 || TALENT:(ARG:1):예속 || TALENT:(ARG:1):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):연모 || TALENT:(ARG:1):복종 || TALENT:(ARG:1):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
ENDIF

SIF IS_ANIMAL(ARG:0)
	LOCAL:0 = ANIMAL_SOURCE_MULTIPLIER(ARG:1, LOCAL:0)

RETURNF LOCAL:0

;-------------------------------------------------
;쾌감계 소스에 필요한 보정을 건 값을 돌려주는 함수(Ｐ에의 봉사계)
;ARG:0=봉사측의 캐릭터 번호, ARG:1=상대의 캐릭터 번호, ARG:2=쾌감 소스의 기본치
;-------------------------------------------------
@SENSE_HOUSHI_P(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.50
	CASE 1
		TIMES LOCAL:0, 1.00
	CASE 2
		TIMES LOCAL:0, 1.60
	CASE 3
		TIMES LOCAL:0, 2.20
	CASE 4
		TIMES LOCAL:0, 2.80
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 10 + 290) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.07
	CASE 2
		TIMES LOCAL:0, 1.14
	CASE 3
		TIMES LOCAL:0, 1.21
	CASE 4
		TIMES LOCAL:0, 1.28
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 135) / 100
ENDSELECT

;봉사 대상이 주인공의 경우
IF ARG:1 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):친애 || TALENT:(ARG:0):예속 || TALENT:(ARG:0):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):연모 || TALENT:(ARG:0):복종 || TALENT:(ARG:0):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

;주인공에 의한 봉사의 경우
ELSEIF ARG:0 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):친애 || TALENT:(ARG:1):예속 || TALENT:(ARG:1):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):연모 || TALENT:(ARG:1):복종 || TALENT:(ARG:1):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):친구
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1

ENDIF

SIF IS_ANIMAL(ARG:0)
	LOCAL:0 = ANIMAL_SOURCE_MULTIPLIER(ARG:1, LOCAL:0)

RETURNF LOCAL:0

;-------------------------------------------------
;쾌감계 소스에 필요한 보정을 건 값을 돌려주는 함수(성교계·플레이어측·Ｐ이외)
;ARG:0=봉사측의 캐릭터 번호, ARG:1=상대의 캐릭터 번호, ARG:2=쾌감 소스의 기본치
;-------------------------------------------------
@SENSE_SEX_PLAYER(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.7
	CASE 1
		TIMES LOCAL:0, 0.85
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.15
	CASE 4
		TIMES LOCAL:0, 1.30
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 2 + 132) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.05
	CASE 2
		TIMES LOCAL:0, 1.10
	CASE 3
		TIMES LOCAL:0, 1.15
	CASE 4
		TIMES LOCAL:0, 1.20
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 123) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):성교
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성교 - 5) * 1 + 130) / 100
ENDSELECT

;봉사 대상이 주인공의 경우
IF ARG:1 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):친애 || TALENT:(ARG:0):예속 || TALENT:(ARG:0):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):연모 || TALENT:(ARG:0):복종 || TALENT:(ARG:0):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):친구
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8


;주인공에 의한 봉사의 경우
ELSEIF ARG:0 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):친애 || TALENT:(ARG:1):예속 || TALENT:(ARG:1):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):연모 || TALENT:(ARG:1):복종 || TALENT:(ARG:1):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):친구
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1

ENDIF

RETURNF LOCAL:0

;-------------------------------------------------
;쾌감계 소스에 필요한 보정을 건 값을 돌려주는 함수(성교계·타겟측·Ｐ이외)
;ARG:0=봉사측의 캐릭터 번호, ARG:1=상대의 캐릭터 번호, ARG:2=쾌감 소스의 기본치
;-------------------------------------------------
@SENSE_SEX_TARGET(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.5
	CASE 1
		TIMES LOCAL:0, 0.75
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.30
	CASE 4
		TIMES LOCAL:0, 1.60
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 3 + 163) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.05
	CASE 2
		TIMES LOCAL:0, 1.10
	CASE 3
		TIMES LOCAL:0, 1.15
	CASE 4
		TIMES LOCAL:0, 1.20
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 123) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):성교
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성교 - 5) * 1 + 130) / 100
ENDSELECT

;봉사 대상이 주인공의 경우
IF ARG:1 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):친애 || TALENT:(ARG:0):예속 || TALENT:(ARG:0):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):연모 || TALENT:(ARG:0):복종 || TALENT:(ARG:0):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):친구
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

;주인공에 의한 봉사의 경우
ELSEIF ARG:0 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):친애 || TALENT:(ARG:1):예속 || TALENT:(ARG:1):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):연모 || TALENT:(ARG:1):복종 || TALENT:(ARG:1):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1

ENDIF

RETURNF LOCAL:0

;-------------------------------------------------
;쾌감계 소스에 필요한 보정을 건 값을 돌려주는 함수(성교계·플레이어측·쾌Ｐ전용)
;ARG:0=봉사측의 캐릭터 번호, ARG:1=상대의 캐릭터 번호, ARG:2=쾌감 소스의 기본치
;-------------------------------------------------
@SENSE_SEX_PLAYER_P(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.70
	CASE 1
		TIMES LOCAL:0, 0.85
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.40
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 3 + 143) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.07
	CASE 2
		TIMES LOCAL:0, 1.14
	CASE 3
		TIMES LOCAL:0, 1.21
	CASE 4
		TIMES LOCAL:0, 1.28
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 135) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):성교
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성교 - 5) * 1 + 130) / 100
ENDSELECT

;봉사 대상이 주인공의 경우
IF ARG:1 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):친애 || TALENT:(ARG:0):예속 || TALENT:(ARG:0):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):연모 || TALENT:(ARG:0):복종 || TALENT:(ARG:0):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

;주인공에 의한 봉사의 경우
ELSEIF ARG:0 == MASTER
	;주인공에게는 봉사·성교의 보정이 없기에 Default로 쾌감량 상승
	TIMES LOCAL:0, 1.70

	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):친애 || TALENT:(ARG:1):예속 || TALENT:(ARG:1):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):연모 || TALENT:(ARG:1):복종 || TALENT:(ARG:1):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1

ENDIF

RETURNF LOCAL:0

;-------------------------------------------------
;쾌감계 소스에 필요한 보정을 건 값을 돌려주는 함수(성교계·타겟측·쾌Ｐ전용)
;ARG:0=봉사측의 캐릭터 번호, ARG:1=상대의 캐릭터 번호, ARG:2=쾌감 소스의 기본치
;-------------------------------------------------
@SENSE_SEX_TARGET_P(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.5
	CASE 1
		TIMES LOCAL:0, 1.00
	CASE 2
		TIMES LOCAL:0, 1.50
	CASE 3
		TIMES LOCAL:0, 2.00
	CASE 4
		TIMES LOCAL:0, 2.50
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 9 + 259) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.07
	CASE 2
		TIMES LOCAL:0, 1.14
	CASE 3
		TIMES LOCAL:0, 1.21
	CASE 4
		TIMES LOCAL:0, 1.28
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 135) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):성교
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성교 - 5) * 1 + 130) / 100
ENDSELECT

;봉사 대상이 주인공의 경우
IF ARG:1 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):친애 || TALENT:(ARG:0):예속 || TALENT:(ARG:0):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):연모 || TALENT:(ARG:0):복종 || TALENT:(ARG:0):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

;주인공에 의한 봉사의 경우
ELSEIF ARG:0 == MASTER
	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):친애 || TALENT:(ARG:1):예속 || TALENT:(ARG:1):소유자
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):연모 || TALENT:(ARG:1):복종 || TALENT:(ARG:1):주인
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):친구
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1

ENDIF



RETURNF LOCAL:0

;-------------------------------------------------
;봉사의 소스에, ARG:0번의 캐릭터의 봉사·성기술에 의한 보정치를 걸어 돌려주는 함수(봉사계)
;ARG:1=소스의 기본치
;-------------------------------------------------
@SERVE_HOUSHI(ARG:0, ARG:1)
#FUNCTION
LOCAL:0 = ARG:1

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.15
	CASE 2
		TIMES LOCAL:0, 1.30
	CASE 3
		TIMES LOCAL:0, 1.45
	CASE 4
		TIMES LOCAL:0, 1.60
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 2 + 170) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.40
	CASE 1
		TIMES LOCAL:0, 0.60
	CASE 2
		TIMES LOCAL:0, 0.80
	CASE 3
		TIMES LOCAL:0, 1.00
	CASE 4
		TIMES LOCAL:0, 1.20
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 2 + 140) / 100
ENDSELECT

RETURNF LOCAL:0

;-------------------------------------------------
;봉사·달성의 소스에, ARG:0번의 캐릭터의 봉사·성기술에 의한 보정치를 걸어 돌려주는 함수(성교계)
;ARG:1=소스의 기본치
;-------------------------------------------------
@SERVE_SEX(ARG:0, ARG:1)
#FUNCTION
LOCAL:0 = ARG:1

SELECTCASE ABL:(ARG:0):봉사
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.20
	CASE 2
		TIMES LOCAL:0, 1.40
	CASE 3
		TIMES LOCAL:0, 1.60
	CASE 4
		TIMES LOCAL:0, 1.80
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):봉사 - 5) * 1 + 20) / 10
ENDSELECT

SELECTCASE ABL:(ARG:0):성기술
	CASE 0
		TIMES LOCAL:0, 0.50
	CASE 1
		TIMES LOCAL:0, 1.00
	CASE 2
		TIMES LOCAL:0, 1.50
	CASE 3
		TIMES LOCAL:0, 2.00
	CASE 4
		TIMES LOCAL:0, 2.50
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):성기술 - 5) * 2 + 34) / 10
ENDSELECT

RETURNF LOCAL:0

;-------------------------------------------------
;성교의 공통 소스 보정(삽입측)  ARG:0은 대상의, ARG:1은 상대의 캐릭터 번호
;-------------------------------------------------
@COM_COMMON_SEX_P(ARG:0, ARG:1)
;사정 개소와 대상을 세트
CALL STACK_SPERM(ARG:0, ARG:1, 사정부위_질내)

SOURCE:(ARG:0):봉사 = SERVE_SEX(ARG:0, 250)

SELECTCASE ABL:(ARG:1):Ｖ감
	CASE 0
		TIMES SOURCE:(ARG:0):애정, 0.90
	CASE 1
		TIMES SOURCE:(ARG:0):애정, 0.95
	CASE 2
		TIMES SOURCE:(ARG:0):애정, 1.00
	CASE 3
		TIMES SOURCE:(ARG:0):애정, 1.05
	CASE 4
		TIMES SOURCE:(ARG:0):애정, 1.10
	CASEELSE
		SOURCE:(ARG:0):애정 = SOURCE:(ARG:0):애정 * MIN((ABL:(ARG:1):Ｖ감 - 5) * 1 + 115, 300) / 100
ENDSELECT

IF PALAM:(ARG:1):윤활 < PALAMLV:1
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.30
	TIMES SOURCE:(ARG:0):애정, 0.50
ELSEIF PALAM:(ARG:1):윤활 < PALAMLV:3
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.60
	TIMES SOURCE:(ARG:0):애정, 0.80
ELSEIF PALAM:(ARG:1):윤활 < PALAMLV:5
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.80
	TIMES SOURCE:(ARG:0):애정, 1.00
ELSEIF PALAM:(ARG:1):윤활 < PALAMLV:7
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.90
	TIMES SOURCE:(ARG:0):애정, 1.10
ELSE
	TIMES SOURCE:(ARG:0):쾌Ｐ, 1.00
	TIMES SOURCE:(ARG:0):애정, 1.20
ENDIF

IF PALAM:(ARG:0):욕정 < PALAMLV:1
	TIMES SOURCE:(ARG:0):애정, 0.40
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:3
	TIMES SOURCE:(ARG:0):애정, 0.70
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:5
	TIMES SOURCE:(ARG:0):애정, 1.00
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:7
	TIMES SOURCE:(ARG:0):애정, 1.10
ELSE
	TIMES SOURCE:(ARG:0):애정, 1.20
ENDIF

IF TALENT:(ARG:0):동정
	TIMES SOURCE:(ARG:0):애정, 2.50
ENDIF

IF TALENT:(ARG:1):처녀
	TIMES SOURCE:(ARG:0):애정, 2.50
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):연모 || TALENT:(ARG:0):친구
		IF TALENT:(ARG:0):정조관념
			TIMES SOURCE:(ARG:0):애정, 1.50
		ELSEIF TALENT:(ARG:0):정조관념없음
			TIMES SOURCE:(ARG:0):애정, 0.60
		ENDIF
	ELSE
		IF TALENT:(ARG:0):정조관념
			IF TALENT:(ARG:0):동정
				SOURCE:(ARG:0):반감 = 2500
			ELSE
				SOURCE:(ARG:0):반감 = 500
			ENDIF
			TIMES SOURCE:(ARG:0):애정, 0.60
		ELSEIF !TALENT:(ARG:0):정조관념없음
			IF TALENT:(ARG:0):동정
				SOURCE:(ARG:0):반감 = 500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):연인
			TIMES SOURCE:(ARG:0):반감, 0.10
		ENDIF
	ENDIF

	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):반감, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):반감, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):반감, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):반감, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):반감, 0.15
	ELSE
		SOURCE:(ARG:0):반감 = SOURCE:(ARG:0):반감 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
ENDIF

CALL DOUTEI_COMMON(ARG:0, @"%ANAME(ARG:1)%의 질", GET_SITUATION_BY_TRAIN_MODE())

EXP:(ARG:0):Ｖ삽입경험 ++

IF TALENT:(ARG:0):동정 && HAS_PENIS(ARG:0)
	IF ARG:1 == MASTER
		;동정상실 플래그(주인과의 성교)
		TCVAR:(ARG:0):14 = 1
	ELSE
		;동정상실 플래그(주인 의외로의 성교)
		TCVAR:(ARG:0):14 = 3
	ENDIF
ENDIF

;-------------------------------------------------
;성교의 공통 소스 보정(피삽입측)  ARG:0은 대상의, ARG:1은 상대의 캐릭터 번호
;-------------------------------------------------
@COM_COMMON_SEX_V(ARG:0, ARG:1)
SOURCE:(ARG:0):봉사 = SERVE_SEX(ARG:0, 200)

SELECTCASE ABL:(ARG:0):Ｖ감
	CASE 0
		SOURCE:(ARG:0):고통 += 300
	CASE 1
		SOURCE:(ARG:0):고통 += 100
	CASE 2
		SOURCE:(ARG:0):고통 += 30
ENDSELECT

IF PALAM:(ARG:0):윤활 < PALAMLV:1
	TIMES SOURCE:(ARG:0):쾌Ｖ, 0.05
	SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * 4 + 1000
ELSEIF PALAM:(ARG:0):윤활 < PALAMLV:3
	TIMES SOURCE:(ARG:0):쾌Ｖ, 0.20
	SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * 2 + 300
ELSEIF PALAM:(ARG:0):윤활 < PALAMLV:5
	TIMES SOURCE:(ARG:0):쾌Ｖ, 0.60
	TIMES SOURCE:(ARG:0):고통, 1.00
ELSEIF PALAM:(ARG:0):윤활 < PALAMLV:7
	TIMES SOURCE:(ARG:0):쾌Ｖ, 0.85
	TIMES SOURCE:(ARG:0):고통, 0.70
ELSE
	TIMES SOURCE:(ARG:0):쾌Ｖ, 1.00
	TIMES SOURCE:(ARG:0):고통, 0.50
ENDIF

IF TALENT:(ARG:0):체격 == 체격_아이 && TALENT:(ARG:1):체격 != 체격_아이
	IF TALENT:(ARG:1):체격 == 체격_작은체형
		TIMES SOURCE:(ARG:0):고통, 1.50
	ELSE
		TIMES SOURCE:(ARG:0):고통, 2.50
	ENDIF
ELSEIF TALENT:(ARG:0):체격 == 체격_작은체형 && TALENT:(ARG:1):체격 != 체격_작은체형 && TALENT:(ARG:1):체격 != 체격_아이
	TIMES SOURCE:(ARG:0):고통, 1.50
ENDIF

;장대 사이즈로 아픔과 쾌감의 변동
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		TIMES SOURCE:(ARG:0):쾌Ｖ, 0.50
		TIMES SOURCE:(ARG:0):고통, 0.50
	CASE -1
		TIMES SOURCE:(ARG:0):쾌Ｖ, 0.75
		TIMES SOURCE:(ARG:0):고통, 0.75
	CASE 1
		TIMES SOURCE:(ARG:0):쾌Ｖ, 1.25
		TIMES SOURCE:(ARG:0):고통, 1.50
	CASE 2
		TIMES SOURCE:(ARG:0):쾌Ｖ, 1.50
		TIMES SOURCE:(ARG:0):고통, 2.00
ENDSELECT

;삽입측의 ABL 성교로 상해 경감  다만 1～3까지는 아픔 증가  4로 겨우 등 배  100으로부터는 감소하지 않는다
SELECTCASE ABL:(ARG:1):성교
	CASE 0 TO 100
		SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * (120 - SQRT(100 * ABL:(ARG:1):성교)) / 100
	CASEELSE
		TIMES SOURCE:(ARG:0):고통, 0.20
ENDSELECT

IF TALENT:(ARG:0):처녀 == 1
	SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * 2 + 500
ENDIF

IF IS_ANIMAL(ARG:1)
	SOURCE:(ARG:0):고통 = ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, SOURCE:(ARG:0):고통)
	SOURCE:(ARG:0):쾌Ｖ = ANIMAL_SOURCE_MULTIPLIER(ARG:0, SOURCE:(ARG:0):쾌Ｖ)
	IF TALENT:(ARG:1):동물 == 동물_말
		EXP:(ARG:0):Ｖ확장경험 += 1
		CALL TIGHTNESS_DECREASE_V(ARG:0, RAND(5, 10))
	ENDIF
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):연모 || TALENT:(ARG:0):친구
		IF TALENT:(ARG:0):정조관념
			TIMES SOURCE:(ARG:0):애정, 1.50
		ELSEIF TALENT:(ARG:0):정조관념없음
			TIMES SOURCE:(ARG:0):애정, 0.60
		ENDIF
		IF TALENT:(ARG:0):처녀
			SOURCE:(ARG:0):환희 += 1000
			SIF TALENT:(ARG:0):연인
				SOURCE:(ARG:0):환희 += 1500
			SIF TALENT:(ARG:0):친애
				SOURCE:(ARG:0):환희 += 2500
		ENDIF
	ELSE
		IF TALENT:(ARG:0):정조관념
			IF TALENT:(ARG:0):처녀
				SOURCE:(ARG:0):반감 = 5000
			ELSE
				SOURCE:(ARG:0):반감 = 1000
			ENDIF
			TIMES SOURCE:(ARG:0):애정, 0.60
		ELSEIF TALENT:(ARG:0):정조관념없음
			IF TALENT:(ARG:0):처녀
				SOURCE:(ARG:0):반감 = 300
			ENDIF
		ELSE
			IF TALENT:(ARG:0):처녀
				SOURCE:(ARG:0):반감 = 2500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):연인
			TIMES SOURCE:(ARG:0):반감, 0.10
		ENDIF
	ENDIF

	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):반감, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):반감, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):반감, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):반감, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):반감, 0.15
	ELSE
		SOURCE:(ARG:0):반감 = SOURCE:(ARG:0):반감 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
ENDIF

IF !IS_EQUIP_PLAYER(ARG:1, 75) && GETBIT(TALENT:(ARG:0):음란계, 소질_음란_노콘섹스중독)
	SOURCE:(ARG:0):환희 += 500
ENDIF

CALL VIRGIN_COMMON(ARG:0, @"%ANAME(ARG:1)%", GET_SITUATION_BY_TRAIN_MODE())

;대상의 질이 느슨해진다(장대의 사이즈로 변동)
;극소자지(0～1) 작은자지(0～2) 보통(1～3) 왕자지(2～4) 말자지(3～4)
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		LOCAL:1 = RAND(0, 2)
	CASE -1
		LOCAL:1 = RAND(0, 3)
	CASE 0
		LOCAL:1 = RAND(1, 4)
	CASE 1
		LOCAL:1 = RAND(2, 5)
	CASE 2
		LOCAL:1 = RAND(3, 5)
ENDSELECT

CALL TIGHTNESS_DECREASE_V(ARG:0, LOCAL:1)

EXP:(ARG:0):Ｖ성교경험 ++


IF TALENT:(ARG:0):처녀
	IF ARG:1 == MASTER
		;처녀상실 플래그(주인과의 성교)
		TCVAR:(ARG:0):13 = 1
	ELSE
		;처녀상실 플래그(주인 의외로의 성교)
		TCVAR:(ARG:0):13 = 3
	ENDIF
ENDIF

;-------------------------------------------------
;Ａ성교의 공통 소스 보정(삽입측)  ARG:0은 대상의, ARG:1은 상대의 캐릭터 번호
;-------------------------------------------------
@COM_COMMON_ASEX_P(ARG:0, ARG:1)
;사정 개소와 대상을 세트
CALL STACK_SPERM(ARG:0, ARG:1, 사정부위_애널)

SOURCE:(ARG:0):봉사 = SERVE_SEX(ARG:0, 250)

SELECTCASE ABL:(ARG:1):Ａ감
	CASE 0
		TIMES SOURCE:(ARG:0):애정, 0.60
	CASE 1
		TIMES SOURCE:(ARG:0):애정, 0.80
	CASE 2
		TIMES SOURCE:(ARG:0):애정, 0.90
	CASE 3
		TIMES SOURCE:(ARG:0):애정, 1.00
	CASE 4
		TIMES SOURCE:(ARG:0):애정, 1.10
	CASEELSE
		SOURCE:(ARG:0):애정 = SOURCE:(ARG:0):애정 * ((ABL:(ARG:1):Ｖ감 - 5) * 1 + 115) / 100
ENDSELECT

IF PALAM:(ARG:1):윤활 < PALAMLV:1
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.30
	TIMES SOURCE:(ARG:0):애정, 0.50
ELSEIF PALAM:(ARG:1):윤활 < PALAMLV:3
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.60
	TIMES SOURCE:(ARG:0):애정, 0.80
ELSEIF PALAM:(ARG:1):윤활 < PALAMLV:5
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.80
	TIMES SOURCE:(ARG:0):애정, 1.00
ELSEIF PALAM:(ARG:1):윤활 < PALAMLV:7
	TIMES SOURCE:(ARG:0):쾌Ｐ, 0.90
	TIMES SOURCE:(ARG:0):애정, 1.10
ELSE
	TIMES SOURCE:(ARG:0):쾌Ｐ, 1.00
	TIMES SOURCE:(ARG:0):애정, 1.20
ENDIF

IF PALAM:(ARG:0):욕정 < PALAMLV:1
	TIMES SOURCE:(ARG:0):애정, 0.40
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:3
	TIMES SOURCE:(ARG:0):애정, 0.70
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:5
	TIMES SOURCE:(ARG:0):애정, 1.00
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:7
	TIMES SOURCE:(ARG:0):애정, 1.10
ELSE
	TIMES SOURCE:(ARG:0):애정, 1.20
ENDIF

IF TALENT:(ARG:0):동정
	TIMES SOURCE:(ARG:0):애정, 2.50
ENDIF

IF TALENT:(ARG:1):처녀
	TIMES SOURCE:(ARG:0):애정, 2.50
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):연모 || TALENT:(ARG:0):친구
		IF TALENT:(ARG:0):정조관념
			TIMES SOURCE:(ARG:0):애정, 1.50
		ELSEIF TALENT:(ARG:0):정조관념없음
			TIMES SOURCE:(ARG:0):애정, 0.60
		ENDIF
	ELSE
		IF TALENT:(ARG:0):정조관념
			IF TALENT:(ARG:0):동정
				SOURCE:(ARG:0):반감 = 2500
			ELSE
				SOURCE:(ARG:0):반감 = 500
			ENDIF
			TIMES SOURCE:(ARG:0):애정, 0.60
		ELSEIF !TALENT:(ARG:0):정조관념없음
			IF TALENT:(ARG:0):동정
				SOURCE:(ARG:0):반감 = 500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):연인
			TIMES SOURCE:(ARG:0):반감, 0.10
		ENDIF
	ENDIF

	;호감도와 종속도와 지배도의 쳐 큰 편이 영향
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):반감, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):반감, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):반감, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):반감, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):반감, 0.15
	ELSE
		SOURCE:(ARG:0):반감 = SOURCE:(ARG:0):반감 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
ENDIF

CALL DOUTEI_COMMON(ARG:0, @"%ANAME(ARG:1)%의 애널", GET_SITUATION_BY_TRAIN_MODE())

EXP:(ARG:0):Ａ삽입경험 ++

IF TALENT:(ARG:0):동정 && HAS_PENIS(ARG:0)
	IF ARG:1 == MASTER
		;동정상실 플래그(주인과의 성교)
		TCVAR:(ARG:0):14 = 1
	ELSE
		;동정상실 플래그(주인 의외로의 성교)
		TCVAR:(ARG:0):14 = 3
	ENDIF
ENDIF

;-------------------------------------------------
;Ａ성교의 공통 소스 보정(피삽입측)  ARG:0은 대상의, ARG:1은 상대의 캐릭터 번호
;-------------------------------------------------
@COM_COMMON_ASEX_A(ARG:0, ARG:1)
SOURCE:(ARG:0):봉사 = SERVE_SEX(ARG:0, 150)

SELECTCASE ABL:(ARG:0):Ａ감
	CASE 0
		TIMES SOURCE:(ARG:0):애정, 0.30
		SOURCE:(ARG:0):고통 += 1200
	CASE 1
		TIMES SOURCE:(ARG:0):애정, 0.60
		SOURCE:(ARG:0):고통 += 500
	CASE 2
		TIMES SOURCE:(ARG:0):애정, 0.90
		SOURCE:(ARG:0):고통 += 200
	CASE 3
		TIMES SOURCE:(ARG:0):애정, 1.10
		SOURCE:(ARG:0):고통 += 80
	CASE 4
		TIMES SOURCE:(ARG:0):애정, 1.20
		SOURCE:(ARG:0):고통 += 30
	CASEELSE
		SOURCE:(ARG:0):애정 = SOURCE:(ARG:0):애정 * ((ABL:(ARG:0):Ａ감 - 5) * 2 + 130) / 100
ENDSELECT

IF PALAM:(ARG:0):윤활 < PALAMLV:1
	TIMES SOURCE:(ARG:0):쾌Ａ, 0.05
	SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * 3 + 1000
ELSEIF PALAM:(ARG:0):윤활 < PALAMLV:3
	TIMES SOURCE:(ARG:0):쾌Ａ, 0.20
	SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * 3 / 2 + 300
ELSEIF PALAM:(ARG:0):윤활 < PALAMLV:5
	TIMES SOURCE:(ARG:0):쾌Ａ, 0.60
	TIMES SOURCE:(ARG:0):고통, 1.00
ELSEIF PALAM:(ARG:0):윤활 < PALAMLV:7
	TIMES SOURCE:(ARG:0):쾌Ａ, 0.85
	TIMES SOURCE:(ARG:0):고통, 0.70
ELSE
	TIMES SOURCE:(ARG:0):쾌Ａ, 1.00
	TIMES SOURCE:(ARG:0):고통, 0.50
ENDIF

IF TALENT:(ARG:0):체격 == 체격_아이 && TALENT:(ARG:1):체격 != 체격_아이
	IF TALENT:(ARG:1):체격 == 체격_작은체형
		TIMES SOURCE:(ARG:0):고통, 1.50
	ELSE
		TIMES SOURCE:(ARG:0):고통, 2.50
	ENDIF
ELSEIF TALENT:(ARG:0):체격 == 체격_작은체형 && TALENT:(ARG:1):체격 != 체격_작은체형 && TALENT:(ARG:1):체격 != 체격_아이
	TIMES SOURCE:(ARG:0):고통, 1.50
ENDIF

;장대 사이즈로 아픔과 쾌감의 변동
SELECTCASE GET_PENISSIZE(ARG:1)
CASE -2
	TIMES SOURCE:(ARG:0):쾌Ａ, 0.50
	TIMES SOURCE:(ARG:0):고통, 0.50
CASE -1
	TIMES SOURCE:(ARG:0):쾌Ａ, 0.75
	TIMES SOURCE:(ARG:0):고통, 0.75
CASE 1
	TIMES SOURCE:(ARG:0):쾌Ａ, 1.25
	TIMES SOURCE:(ARG:0):고통, 1.50
CASE 2
	TIMES SOURCE:(ARG:0):쾌Ａ, 1.50
	TIMES SOURCE:(ARG:0):고통, 2.00
ENDSELECT

;삽입측의 ABL 성교로 상해 경감  다만 1～3까지는 아픔 증가  4로 겨우 등 배  100으로부터는 감소하지 않는다
SELECTCASE ABL:(ARG:1):성교
	CASE 0 TO 100
		SOURCE:(ARG:0):고통 = SOURCE:(ARG:0):고통 * (120 - SQRT(100 * ABL:(ARG:1):성교)) / 100
	CASEELSE
		TIMES SOURCE:(ARG:0):고통, 0.20
ENDSELECT

IF IS_ANIMAL(ARG:1)
	SOURCE:(ARG:0):고통 = ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, SOURCE:(ARG:0):고통)
	SOURCE:(ARG:0):쾌Ａ = ANIMAL_SOURCE_MULTIPLIER(ARG:0, SOURCE:(ARG:0):쾌Ａ)
	IF TALENT:(ARG:1):동물 == 동물_말
			EXP:(ARG:0):Ａ확장경험 += 1
			CALL TIGHTNESS_DECREASE_A(ARG:0, RAND(5, 10))
	ENDIF
ENDIF

IF PALAM:(ARG:0):욕정 < PALAMLV:1
	TIMES SOURCE:(ARG:0):애정, 0.40
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:3
	TIMES SOURCE:(ARG:0):애정, 0.70
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:5
	TIMES SOURCE:(ARG:0):애정, 1.00
ELSEIF PALAM:(ARG:0):욕정 < PALAMLV:7
	TIMES SOURCE:(ARG:0):애정, 1.10
ELSE
	TIMES SOURCE:(ARG:0):애정, 1.20
ENDIF


IF ARG:0 != MASTER && ARG:1 == MASTER
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_바람기버릇)
		TIMES LOCAL:0, 1.1
ENDIF


IF !IS_EQUIP_PLAYER(ARG:1, 75) && GETBIT(TALENT:(ARG:0):음란계, 소질_음란_노콘섹스중독)
	SOURCE:(ARG:0):환희 += 500
ENDIF

CALL VIRGIN_COMMON_A(ARG:0, @"%ANAME(ARG:1)%", GET_SITUATION_BY_TRAIN_MODE())

EXP:(ARG:0):Ａ성교경험 ++

;대상의 애널이 느슨해진다(장대의 사이즈로 변동)
;극소자지(0～1) 작은자지(0～2) 보통(1～3) 왕자지(2～4) 말자지(3～4)
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		LOCAL:1 = RAND(0, 2)
	CASE -1
		LOCAL:1 = RAND(0, 3)
	CASE 0
		LOCAL:1 = RAND(1, 4)
	CASE 1
		LOCAL:1 = RAND(2, 5)
	CASE 2
		LOCAL:1 = RAND(3, 5)
ENDSELECT


CALL TIGHTNESS_DECREASE_A(ARG:0, LOCAL:1)

;------------------
;동물 캐릭터에게 뭔가 되는 or 뭔가 할 때의, 수간경험에 의한 보정 계산
;ARG:0이 캐릭터, ARG:1이 계산하고 싶은 수치
;-----------------
@ANIMAL_SOURCE_MULTIPLIER(ARG:0, ARG:1)
#FUNCTION
SELECTCASE EXP:(ARG:0):수간경험
		CASE IS < 50
			TIMES ARG:1, 0.50
		CASE IS < 100
			TIMES ARG:1, 0.70
		CASE IS < 150
			TIMES ARG:1, 1.00
		CASE IS < 200
			TIMES ARG:1, 1.10
		CASE IS < 300
			TIMES ARG:1, 1.20
		CASEELSE
			TIMES ARG:1, 1.30
ENDSELECT
SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_암캐)
	TIMES ARG:1, 1.10
RETURNF ARG:1

;------------------
;동물 캐릭터에게 뭔가 되는 or 뭔가 할 때의, 수간경험에 의한 역보정 계산
;ARG:0이 캐릭터, ARG:1이 계산하고 싶은 수치
;-----------------
@ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, ARG:1)
#FUNCTION
SELECTCASE EXP:(ARG:0):수간경험
		CASE IS < 50
			TIMES ARG:1, 1.50
		CASE IS < 100
			TIMES ARG:1, 1.25
		CASE IS < 150
			TIMES ARG:1, 1.00
		CASE IS < 200
			TIMES ARG:1, 0.90
		CASE IS < 300
			TIMES ARG:1, 0.80
		CASEELSE
			TIMES ARG:1, 0.70
ENDSELECT
SIF GETBIT(TALENT:(ARG:0):음란계, 소질_음란_암캐)
	TIMES ARG:1, 0.8
RETURNF ARG:1
