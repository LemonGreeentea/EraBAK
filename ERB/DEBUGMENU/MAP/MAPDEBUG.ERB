[SKIPSTART]
MAPDEBUG
========
개요
----
  지도를 시나리오로부터 잘라 정상적으로 기능하고 있을까 테스트하기 위한 기능.
MAP_LIBRARY를 이용하고 있지 않으면 사용할 수 없기에 주의.
[SKIPEND]

;지도의 디버그의 엔트리 포인트
;지도를 선택하거나 그만두거나 할 수가 있다
@MAPDEBUG()
#DIMS DEFAULT_MAPID
#DIM SELECTEDMENU
#DIM LCOUNT
#DIM CITY_ID
;여기는 게임의 밖인 것으로 그것을 상황 좋게 이용해 고쳐 쓰고 빠져 나갈 때 Default치에 되돌린다
DEFAULT_MAPID '= MAPID
MAPID '= ""
CITY_ID = 0
WHILE 1
	CALL SHOP_AVAIL_MAPDEBUG_SET
	CALL SINGLE_DRAWLINE
	PRINTFORML MAPDEBUG 현재 선택되고 있는 맵 %(MAPID == "" ? "미선택" # MAPID)%
	PRINT -------------- 0 1□□□◇□□□□10□□□□◇□□□□20□□□□◇□□□□30□□□□◇□□□□□40□□□□◇□47
	IF MAPID != ""
		CALL DRAWMAP(DRAWMAP_MENUBARTYPE_DEBUGMENU)
		CALL SHOW_CITY_INFO_MAPDEBUG(CITY_ID)
	ELSE
		FOR LCOUNT, 0, LINES_SHOP_DRAW
			CALL PRINT_MAPDEBUG_MENU(LCOUNT)
			SELECTCASE LCOUNT
				CASE MENU_HEIGHT
					CALL REPEAT_DASH(0, 0)
			ENDSELECT
			PRINTL
		NEXT
	ENDIF
	INPUT
	SELECTEDMENU = RESULT
	SELECTCASE SELECTEDMENU
		CASE 0
			MAPID '= DEFAULT_MAPID
			CALL DELETE_MAP_STATUS_DEBUG()
			RETURN
		CASE 1
			CALL DEBUG_SELECT_MAPID()
			CITY_ID = 0
		CASE 2
			SIF MAPID != ""
				CALL DEBUG_CHECK_MAP_CONNECTION()
	ENDSELECT
	IF MAPID != ""
		SELECTCASE SELECTEDMENU
			CASE IS > 1000
				IF CITY_NAME:(SELECTEDMENU - 1000) != "무명"
					CITY_ID = SELECTEDMENU - 1000
				ENDIF
		ENDSELECT
	ENDIF
WEND

@DEBUG_SELECT_MAPID()
#DIMS hoge
#DIM DEFAULT_CITY_NUM
	DEFAULT_CITY_NUM = CITY_NUM
	CALL SINGLE_DRAWLINE
	PRINTL 맵 선택
	PRINTFORML 현재 선택되고 있는 맵 %(MAPID == "" ? "미선택" # MAPID)%
	CALL SINGLE_DRAWLINE
	PRINTL MAPID를 입력해 주세요
	INPUTS
	hoge '= TOUPPER(RESULTS)
	TRYCCALLFORM SET_CITY_NUM_%hoge%
		CITY_NUM = DEFAULT_CITY_NUM
		MAPID '= hoge
		PRINTFORML %MAPID%를 선택했습니다
		CALL RESET_MAPDEBUG_STATUS
		CALL MAPSETUP(1)
		CALL MAP_INIT
	CATCH
		PRINTFORML 입력된 MAPID %hoge% 는 존재하지 않습니다
	ENDCATCH

@DELETE_MAP_STATUS_DEBUG()
VARSET SHOP_AVAIL
CALL RESET_MAPDEBUG_STATUS
MAPREADY = 0

@PRINT_MAPDEBUG_MENU(MENU_LINE)
#DIM MENU_LINE
SELECTCASE MENU_LINE
	CASE 0
		CALL PRINTBUTTON_SHOP_DEBUG(0, "끝난다")
	CASE 1
		CALL PRINTBUTTON_SHOP_DEBUG(1, "맵 선택")
	CASE 2
		CALL PRINTBUTTON_SHOP_DEBUG(2, "맵 접속")
	CASEELSE
		CALL PRINT_MAPDEBUG_MENU_EMPTYLINE()
ENDSELECT
PRINTFORM {MENU_LINE + 1, 2, RIGHT}

@PRINTBUTTON_SHOP_DEBUG(ARG:0, ARGS:0)
CALL PRINTBUTTON_SHOP(ARG:0, @"[%ARGS:0, 10, RIGHT%]", 7)

@PRINT_MAPDEBUG_MENU_EMPTYLINE()
PRINT 　　　　　　　

@SHOP_AVAIL_MAPDEBUG_SET
SHOP_AVAIL:0 = 1
SHOP_AVAIL:1 = 1
SHOP_AVAIL:2 = 1

@DRAW_CITY_BUTTON_MAPDEBUG(CITY_ID)
#DIM CITY_ID
PRINTBUTTON GET_CITYNAME_BUTTON(CITY_ID), CITY_ID + 1000

@RESET_MAPDEBUG_STATUS
VARSET CITY_NUM
VARSET CITY_ROUTE, 0
VARSET CITY_TYPE, 0
VARSET CITY_ECONOMY, 0
VARSET CITY_ECONOMY_LIMIT, 0
VARSET CITY_GUARD, 0
VARSET CITY_NAME_SHORT, "무명"
VARSET CITY_NAME, "무명"

@SHOW_CITY_INFO_MAPDEBUG(CITY_ID)
#DIM CITY_ID
#DIM LCOUNT
FOR LCOUNT, MENU_HEIGHT, LINES_SHOP_DRAW
	CALL PRINT_MAPDEBUG_MENU(LCOUNT)
	SELECTCASE LCOUNT
		;MENU_HEIGHT가 움직이는 일도 생각해 이같이 처리한다
		CASE MENU_HEIGHT
			CALL REPEAT_DASH(0, 0)
		CASE MENU_HEIGHT + 1
			PRINTFORM %@"◆%(CITY_TYPE:CITY_ID == 1 ? @"중계지점(%CITY_NAME:CITY_ID%)" # CITY_NAME:CITY_ID)%◆", 20, LEFT%
		CASE MENU_HEIGHT + 2
			PRINTFORM %@"경제:{CITY_ECONOMY:CITY_ID, 4, RIGHT}/{CITY_ECONOMY_LIMIT:CITY_ID, 4, RIGHT}", 20, LEFT%방위배율:%DECIMAL_STRING(CITY_GUARD:CITY_ID, 2)%
		CASE MENU_HEIGHT + 3
			PRINTFORM 경로 표시:%PRINT_MAPDEBUG_ROUTE(CITY_ID, 1), 40, RIGHT%%PRINT_MAPDEBUG_ROUTE(CITY_ID, 2), 40, RIGHT%
		CASE MENU_HEIGHT + 4
			PRINTFORM 　　　　 %PRINT_MAPDEBUG_ROUTE(CITY_ID, 3), 40, RIGHT%%PRINT_MAPDEBUG_ROUTE(CITY_ID, 4), 40, RIGHT%
		CASE MENU_HEIGHT + 5
			PRINTFORM 　　　　 %PRINT_MAPDEBUG_ROUTE(CITY_ID, 5), 40, RIGHT%%PRINT_MAPDEBUG_ROUTE(CITY_ID, 6), 40, RIGHT%
		CASE MENU_HEIGHT + 6
			PRINTFORM 　　　　 %PRINT_MAPDEBUG_ROUTE(CITY_ID, 7), 40, RIGHT%%PRINT_MAPDEBUG_ROUTE(CITY_ID, 8), 40, RIGHT%
		CASE MENU_HEIGHT + 7
			PRINTFORM 　　　　 %PRINT_MAPDEBUG_ROUTE(CITY_ID, 9), 40, RIGHT%%PRINT_MAPDEBUG_ROUTE(CITY_ID, 10), 40, RIGHT%
	ENDSELECT
	PRINTL
NEXT

@PRINT_MAPDEBUG_ROUTE(CITY_ID, INDEX)
#FUNCTIONS
#DIM CITY_ID
#DIM INDEX
#DIM LCOUNT
#DIM ROUTE_CITY_COUNT
ROUTE_CITY_COUNT = 0
FOR LCOUNT, 0, CITY_NUM + 1
	IF IS_ROUTE(CITY_ID, LCOUNT)
		ROUTE_CITY_COUNT++
		IF ROUTE_CITY_COUNT == INDEX
			SELECTCASE IS_ROUTE(CITY_ID, LCOUNT)
				CASE 1
					RETURNF @"%CITY_NAME:LCOUNT%"
				CASE 2
					RETURNF @"%CITY_NAME:LCOUNT%(중계지점:%CITY_NAME:GET_RELAYPOINT(CITY_ID, LCOUNT)%)"
			ENDSELECT
		ENDIF
	ENDIF
NEXT
	


@GET_ROUTECOUNT(CITY_ID)
#FUNCTION
#DIM CITY_ID
#DIM ROUTECOUNT
#DIM LCOUNT
ROUTECOUNT = 0
FOR LCOUNT, 0, CITY_NUM + 1
	SIF IS_ROUTE(CITY_ID, LCOUNT)
		ROUTECOUNT++
NEXT
RETURNF ROUTECOUNT


@DEBUG_CHECK_MAP_CONNECTION()

FOR LOCAL, 0, MAX_CITY
	FOR LOCAL:1, 0, VARSIZE("CITY_ROUTE", 1)
		SIF CITY_ROUTE:LOCAL:(LOCAL:1) == 0
			CONTINUE
		LOCAL:2 = CITY_ROUTE:LOCAL:(LOCAL:1)
		FOR LOCAL:3, 0, VARSIZE("CITY_ROUTE", 1)
			SIF CITY_ROUTE:(LOCAL:2):(LOCAL:3) == LOCAL
				GOTO FOUND
		NEXT
		CALL COLORPRINT(@"%GET_CITYNAME(LOCAL)%-%GET_CITYNAME(LOCAL:2)%간의 접속이 부정")
		$FOUND
	NEXT
NEXT
PRINTFORML 탐색 완료
WAIT
